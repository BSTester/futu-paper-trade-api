# 安装指南

## 环境要求

- Python 3.8+
- pip 包管理器
- 网络连接（用于安装依赖包）

## 安装步骤

### 1. 克隆或下载项目

```bash
git clone <repository-url>
cd futu-paper-trade-api
```

### 2. 创建虚拟环境（推荐）

```bash
# Windows
python -m venv venv
venv\Scripts\activate

# Linux/Mac
python -m venv venv
source venv/bin/activate
```

### 3. 安装依赖

```bash
pip install -r requirements.txt
```

### 4. 配置环境变量

复制环境变量示例文件：

```bash
# Windows
copy .env.example .env

# Linux/Mac
cp .env.example .env
```

编辑 `.env` 文件，填入你的配置：

```env
# 富途Cookie（必需）
FUTU_COOKIE=your_cookie_here

# 各市场账户ID（按需配置）
ACCOUNT_ID_US=your_us_account_id
ACCOUNT_ID_HK=your_hk_account_id
ACCOUNT_ID_CN=your_cn_account_id
```

### 5. 验证安装

运行测试脚本验证安装：

```bash
python test_place_order.py
```

## 常见问题

### Q1: pydantic-core 安装失败

**错误信息**:
```
Cargo, the Rust package manager, is not installed
```

**解决方案**:

#### 方案1：使用更新的版本（推荐）
更新 `requirements.txt` 使用更新的 pydantic 版本：

```txt
pydantic>=2.9.2
```

然后重新安装：

```bash
pip install -r requirements.txt --upgrade
```

#### 方案2：安装 Rust（如果方案1不行）

1. 访问 https://rustup.rs/
2. 下载并安装 Rust
3. 重启终端
4. 重新运行 `pip install -r requirements.txt`

#### 方案3：使用预编译的 wheel

```bash
pip install pydantic --only-binary :all:
```

### Q2: 依赖冲突警告

如果看到类似这样的警告：

```
ERROR: pip's dependency resolver does not currently take into account all the packages...
```

**说明**: 这些是其他已安装包的依赖冲突，不会影响本项目的运行。

**解决方案**（可选）:
- 使用虚拟环境隔离项目依赖
- 或者忽略这些警告，它们不影响本项目

### Q3: httpx 版本冲突

**错误信息**:
```
requires httpx>=0.27.0, but you have httpx 0.25.1
```

**解决方案**:

如果其他项目需要更高版本的 httpx，可以升级：

```bash
pip install httpx>=0.27.0
```

本项目兼容 httpx 0.25.1 及以上版本。

### Q4: 网络连接问题

如果安装过程中遇到网络问题，可以使用国内镜像：

```bash
# 使用清华镜像
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# 使用阿里镜像
pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple/
```

## 依赖说明

### 核心依赖

| 包名 | 版本 | 说明 |
|------|------|------|
| httpx | >=0.25.1 | 异步HTTP客户端 |
| python-dotenv | >=1.0.0 | 环境变量管理 |
| pydantic | >=2.9.2 | 数据验证 |

### 可选依赖

| 包名 | 版本 | 说明 |
|------|------|------|
| fastapi | >=0.104.1 | REST API框架（如需提供API服务） |
| uvicorn | >=0.24.0 | ASGI服务器（如需提供API服务） |

## 最小安装

如果只需要核心交易功能，可以只安装核心依赖：

```bash
pip install httpx python-dotenv pydantic
```

## 开发环境安装

如果需要开发和测试，建议安装完整依赖：

```bash
pip install -r requirements.txt
```

## 验证安装

### 检查 Python 版本

```bash
python --version
# 应该显示 Python 3.8 或更高版本
```

### 检查依赖包

```bash
pip list | grep -E "httpx|pydantic|python-dotenv"
```

### 运行测试

```bash
# 测试导入
python -c "from futu_client import FutuClient; print('导入成功')"

# 运行测试脚本
python test_place_order.py
```

## 更新依赖

定期更新依赖包以获取最新功能和安全修复：

```bash
pip install -r requirements.txt --upgrade
```

## 卸载

如果需要卸载项目依赖：

```bash
pip uninstall -r requirements.txt -y
```

## 故障排除

### 1. 清理缓存

如果遇到安装问题，尝试清理 pip 缓存：

```bash
pip cache purge
pip install -r requirements.txt --no-cache-dir
```

### 2. 重新创建虚拟环境

```bash
# 删除旧的虚拟环境
rm -rf venv  # Linux/Mac
rmdir /s venv  # Windows

# 创建新的虚拟环境
python -m venv venv
venv\Scripts\activate  # Windows
source venv/bin/activate  # Linux/Mac

# 重新安装依赖
pip install -r requirements.txt
```

### 3. 检查 Python 路径

确保使用正确的 Python 版本：

```bash
which python  # Linux/Mac
where python  # Windows
```

## 技术支持

如果遇到安装问题：

1. 查看本文档的常见问题部分
2. 检查项目 Issues
3. 提交新的 Issue 描述问题

---

**安装成功后，请查看 [快速开始指南](./快速开始指南.md) 开始使用！**
