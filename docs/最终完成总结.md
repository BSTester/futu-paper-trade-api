# å¯Œé€”æ¨¡æ‹Ÿäº¤æ˜“API - æœ€ç»ˆå®Œæˆæ€»ç»“

## å®Œæˆæ—¶é—´
2025-11-01

## ğŸ‰ é¡¹ç›®çŠ¶æ€
**æ‰€æœ‰åŠŸèƒ½å·²å®Œæˆå¹¶æ”¯æŒå¤šå¸‚åœºå·®å¼‚åŒ–æ¥å£ï¼**

---

## ä¸€ã€é‡è¦å‘ç° âš ï¸

### å¸‚åœºæ¥å£å·®å¼‚

å‘ç°å¯Œé€”å¯¹ä¸åŒå¸‚åœºä½¿ç”¨äº†**ä¸åŒçš„æ¥å£ç³»ç»Ÿ**ï¼š

| å¸‚åœº | ä¸‹å•æ¥å£ | æ’¤å•æ¥å£ | å–å‡ºå‚æ•° | ç‰¹æ®Šå‚æ•° |
|------|---------|---------|---------|---------|
| **ç¾è‚¡** | `inputIntegratedOrder` | `cancelIntegratedOrder` | `side=A` | `period_type` |
| **Aè‚¡** | `inputOrder` | `cancelOrder` | `side=S` | `security_type` |
| **æ¸¯è‚¡** | `inputOrder` | `cancelOrder` | `side=S` | `security_type` |

### å…³é”®å·®å¼‚ç‚¹

1. **ç¾è‚¡å–å‡º**: ä½¿ç”¨ `side=A` (Ask) è€Œä¸æ˜¯ `side=S` (Sell)
2. **ç¾è‚¡æ¥å£**: ä½¿ç”¨ `Integrated` ç³»åˆ—æ¥å£
3. **ç¾è‚¡å‚æ•°**: éœ€è¦ `period_type` å‚æ•°ï¼ˆäº¤æ˜“æ—¶æ®µï¼‰
4. **ç¾è‚¡æ’¤å•**: éœ€è¦é¢å¤–çš„ `market_type` å‚æ•°

---

## äºŒã€å®Œæ•´æ¥å£æ¸…å•

### ç¾è‚¡ä¸“ç”¨æ¥å£ âœ…

#### 1. ç¾è‚¡ä¸‹å•
```
POST /paper-trade/common-api?_m=inputIntegratedOrder

å‚æ•°:
{
  "account_id": "16992013",
  "market_type": 100,
  "price": "202.49",
  "side": "B",              # B=ä¹°å…¥, A=å–å‡º
  "quantity": 1,
  "order_type": 1,
  "security_id": "202597",
  "period_type": 2          # 1=ç›˜å‰, 2=æ­£å¸¸, 3=ç›˜å
}
```

#### 2. ç¾è‚¡æ’¤å•
```
POST /paper-trade/common-api?_m=cancelIntegratedOrder

å‚æ•°:
{
  "account_id": "16992013",
  "market_type": 100,
  "order_id": "6363648"
}
```

### Aè‚¡/æ¸¯è‚¡æ¥å£ âœ…

#### 1. Aè‚¡/æ¸¯è‚¡ä¸‹å•
```
POST /paper-trade/common-api?_m=inputOrder

å‚æ•°:
{
  "account_id": "3182575",
  "security_id": "64123863331268",
  "market_type": 3,         # 1=æ¸¯è‚¡, 3=Aè‚¡
  "side": "B",              # B=ä¹°å…¥, S=å–å‡º
  "order_type": 1,
  "price": "5.610",
  "quantity": 100,
  "security_type": 1
}
```

#### 2. Aè‚¡/æ¸¯è‚¡æ’¤å•
```
POST /paper-trade/common-api?_m=cancelOrder

å‚æ•°:
{
  "account_id": "3182575",
  "order_id": "123456789"
}
```

---

## ä¸‰ã€Pythonå®¢æˆ·ç«¯å®ç°

### æ™ºèƒ½æ¥å£é€‰æ‹©

å®¢æˆ·ç«¯å·²æ›´æ–°ä¸º**è‡ªåŠ¨æ ¹æ®å¸‚åœºç±»å‹é€‰æ‹©æ­£ç¡®çš„æ¥å£**ï¼š

```python
async def place_order(self, trade_request: TradeRequest) -> TradeResponse:
    """ä¸‹å•äº¤æ˜“ï¼ˆè‡ªåŠ¨é€‰æ‹©æ¥å£ï¼‰"""
    
    market_type = trade_request.market_type
    
    if market_type == "US":
        # ç¾è‚¡ä½¿ç”¨ inputIntegratedOrder
        params = {"_m": "inputIntegratedOrder"}
        side_code = "B" if side == "BUY" else "A"  # ç¾è‚¡å–å‡ºç”¨A
        order_data = {
            "account_id": str(account_id),
            "market_type": 100,
            "side": side_code,
            "period_type": 2,  # æ­£å¸¸äº¤æ˜“æ—¶æ®µ
            ...
        }
    else:
        # Aè‚¡/æ¸¯è‚¡ä½¿ç”¨ inputOrder
        params = {"_m": "inputOrder"}
        side_code = "B" if side == "BUY" else "S"  # Aè‚¡/æ¸¯è‚¡å–å‡ºç”¨S
        order_data = {
            "account_id": str(account_id),
            "market_type": market_type_code,
            "side": side_code,
            "security_type": 1,
            ...
        }
    
    # æäº¤è®¢å•
    data = await self._request("POST", url, params=params, json=order_data)
    ...
```

### æ’¤å•æ¥å£é€‰æ‹©

```python
async def cancel_order(self, order_id: str, market_type: str) -> TradeResponse:
    """æ’¤å•ï¼ˆè‡ªåŠ¨é€‰æ‹©æ¥å£ï¼‰"""
    
    if market_type == "US":
        # ç¾è‚¡ä½¿ç”¨ cancelIntegratedOrder
        params = {"_m": "cancelIntegratedOrder"}
        cancel_data = {
            "account_id": str(account_id),
            "market_type": 100,
            "order_id": str(order_id)
        }
    else:
        # Aè‚¡/æ¸¯è‚¡ä½¿ç”¨ cancelOrder
        params = {"_m": "cancelOrder"}
        cancel_data = {
            "account_id": str(account_id),
            "order_id": str(order_id)
        }
    
    data = await self._request("POST", url, params=params, json=cancel_data)
    ...
```

---

## å››ã€ä½¿ç”¨ç¤ºä¾‹

### ç»Ÿä¸€çš„APIè°ƒç”¨

ç”¨æˆ·æ— éœ€å…³å¿ƒåº•å±‚æ¥å£å·®å¼‚ï¼Œä½¿ç”¨ç»Ÿä¸€çš„APIï¼š

```python
from futu_client import FutuClient
from models import TradeRequest

client = FutuClient()

# ç¾è‚¡ä¹°å…¥ - è‡ªåŠ¨ä½¿ç”¨ inputIntegratedOrder
trade_request = TradeRequest(
    stock_code="AAPL",
    market_type="US",
    side="BUY",
    order_type="LIMIT",
    price=180.0,
    quantity=10,
    security_type="STOCK"
)
result = await client.place_order(trade_request)

# ç¾è‚¡å–å‡º - è‡ªåŠ¨è½¬æ¢ä¸º side=A
trade_request = TradeRequest(
    stock_code="AAPL",
    market_type="US",
    side="SELL",  # å†…éƒ¨è‡ªåŠ¨è½¬æ¢ä¸º side=A
    order_type="LIMIT",
    price=185.0,
    quantity=10,
    security_type="STOCK"
)
result = await client.place_order(trade_request)

# Aè‚¡ä¹°å…¥ - è‡ªåŠ¨ä½¿ç”¨ inputOrder
trade_request = TradeRequest(
    stock_code="601988",
    market_type="CN",
    side="BUY",
    order_type="LIMIT",
    price=5.61,
    quantity=100,
    security_type="STOCK"
)
result = await client.place_order(trade_request)

# æ’¤å• - è‡ªåŠ¨é€‰æ‹©æ¥å£
result = await client.cancel_order(
    order_id="123456789",
    market_type="US"  # è‡ªåŠ¨ä½¿ç”¨ cancelIntegratedOrder
)
```

---

## äº”ã€å®Œæ•´åŠŸèƒ½åˆ—è¡¨

### äº¤æ˜“åŠŸèƒ½ âœ…
- [x] ç¾è‚¡ä¹°å…¥ - `inputIntegratedOrder` + `side=B`
- [x] ç¾è‚¡å–å‡º - `inputIntegratedOrder` + `side=A`
- [x] ç¾è‚¡æ’¤å• - `cancelIntegratedOrder`
- [x] Aè‚¡ä¹°å…¥ - `inputOrder` + `side=B`
- [x] Aè‚¡å–å‡º - `inputOrder` + `side=S`
- [x] Aè‚¡æ’¤å• - `cancelOrder`
- [x] æ¸¯è‚¡ä¹°å…¥ - `inputOrder` + `side=B`
- [x] æ¸¯è‚¡å–å‡º - `inputOrder` + `side=S`
- [x] æ¸¯è‚¡æ’¤å• - `cancelOrder`

### è´¦æˆ·ç®¡ç† âœ…
- [x] è·å–è´¦æˆ·åˆ—è¡¨
- [x] è·å–è´¦æˆ·è¯¦æƒ…
- [x] æŸ¥è¯¢æŒä»“
- [x] è‡ªåŠ¨è´¦æˆ·åŒ¹é…

### è¡Œæƒ…æ•°æ® âœ…
- [x] æœç´¢è‚¡ç¥¨
- [x] è·å–æŠ¥ä»·
- [x] è·å–Kçº¿
- [x] çƒ­é—¨è‚¡ç¥¨

### è®¢å•ç®¡ç† âœ…
- [x] è®¢å•å†å²æŸ¥è¯¢
- [x] è®¢å•çŠ¶æ€æŸ¥è¯¢
- [x] é£æ§æ£€æŸ¥

---

## å…­ã€æŠ€æœ¯äº®ç‚¹

### 1. æ™ºèƒ½æ¥å£è·¯ç”±
- è‡ªåŠ¨è¯†åˆ«å¸‚åœºç±»å‹
- è‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„æ¥å£
- è‡ªåŠ¨è½¬æ¢å‚æ•°æ ¼å¼

### 2. ç»Ÿä¸€çš„ç”¨æˆ·API
- ç”¨æˆ·æ— éœ€å…³å¿ƒåº•å±‚å·®å¼‚
- ç»Ÿä¸€çš„è°ƒç”¨æ–¹å¼
- ä¸€è‡´çš„è¿”å›æ ¼å¼

### 3. å®Œæ•´çš„é”™è¯¯å¤„ç†
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- å¼‚å¸¸æ•è·
- æ—¥å¿—è®°å½•

### 4. ç±»å‹å®‰å…¨
- Pydanticæ¨¡å‹éªŒè¯
- ç±»å‹æç¤º
- å‚æ•°æ ¡éªŒ

---

## ä¸ƒã€æ–‡æ¡£æ¸…å•

### æ ¸å¿ƒæ–‡æ¡£
1. âœ… `APIæ¥å£æ–‡æ¡£.md` - å®Œæ•´APIè¯´æ˜
2. âœ… `ä½¿ç”¨ç¤ºä¾‹.md` - ä½¿ç”¨æŒ‡å—
3. âœ… `å–å‡ºå’Œæ’¤å•æ¥å£è¯´æ˜.md` - å–å‡ºæ’¤å•ä¸“é¡¹
4. âœ… `ç¾è‚¡ä¸“ç”¨æ¥å£è¯´æ˜.md` - ç¾è‚¡æ¥å£è¯¦è§£
5. âœ… `å®Œæ•´åŠŸèƒ½æ€»ç»“.md` - åŠŸèƒ½æ€»ç»“
6. âœ… `æœ€ç»ˆå®Œæˆæ€»ç»“.md` - æœ¬æ–‡æ¡£

### ä»£ç æ–‡ä»¶
1. âœ… `futu_client.py` - æ ¸å¿ƒå®¢æˆ·ç«¯ï¼ˆå·²æ›´æ–°ï¼‰
2. âœ… `config.py` - é…ç½®æ–‡ä»¶
3. âœ… `models.py` - æ•°æ®æ¨¡å‹
4. âœ… `.env` - ç¯å¢ƒå˜é‡
5. âœ… `.env.example` - ç¯å¢ƒå˜é‡ç¤ºä¾‹

### æµ‹è¯•æ–‡ä»¶
1. âœ… `test_place_order.py` - ä¸‹å•æµ‹è¯•
2. âœ… `test_real_trade.py` - å®é™…äº¤æ˜“æµ‹è¯•
3. âœ… `test_sell_and_cancel.py` - å–å‡ºæ’¤å•æµ‹è¯•

---

## å…«ã€éªŒè¯è®°å½•

### å®é™…éªŒè¯

#### ç¾è‚¡æ¥å£ âœ…
- **ä¹°å…¥**: `inputIntegratedOrder` + `side=B` + `period_type=2`
- **å–å‡º**: `inputIntegratedOrder` + `side=A` + `period_type=2`
- **æ’¤å•**: `cancelIntegratedOrder` + `market_type=100`

#### Aè‚¡æ¥å£ âœ…
- **ä¹°å…¥**: `inputOrder` + `side=B` + `security_type=1`
- **å–å‡º**: `inputOrder` + `side=S` + `security_type=1`
- **æ’¤å•**: `cancelOrder`

#### ç½‘ç»œè¯·æ±‚éªŒè¯ âœ…
```
# ç¾è‚¡
POST /paper-trade/common-api?_m=inputIntegratedOrder
POST /paper-trade/common-api?_m=cancelIntegratedOrder

# Aè‚¡/æ¸¯è‚¡
POST /paper-trade/common-api?_m=inputOrder
POST /paper-trade/common-api?_m=cancelOrder
```

---

## ä¹ã€å‚æ•°å¯¹ç…§è¡¨

### ä¸‹å•å‚æ•°å¯¹ç…§

| å‚æ•° | ç¾è‚¡ | Aè‚¡/æ¸¯è‚¡ | è¯´æ˜ |
|------|------|---------|------|
| æ¥å£ | `inputIntegratedOrder` | `inputOrder` | ä¸åŒæ¥å£ |
| ä¹°å…¥ | `side=B` | `side=B` | ç›¸åŒ |
| å–å‡º | `side=A` | `side=S` | **ä¸åŒ** |
| å¸‚åœº | `market_type=100` | `market_type=1/3` | æ•°å€¼ä¸åŒ |
| æ—¶æ®µ | `period_type=2` | - | ç¾è‚¡ç‰¹æœ‰ |
| ç±»å‹ | - | `security_type=1` | Aè‚¡/æ¸¯è‚¡ç‰¹æœ‰ |

### æ’¤å•å‚æ•°å¯¹ç…§

| å‚æ•° | ç¾è‚¡ | Aè‚¡/æ¸¯è‚¡ | è¯´æ˜ |
|------|------|---------|------|
| æ¥å£ | `cancelIntegratedOrder` | `cancelOrder` | ä¸åŒæ¥å£ |
| è´¦æˆ· | `account_id` | `account_id` | ç›¸åŒ |
| è®¢å• | `order_id` | `order_id` | ç›¸åŒ |
| å¸‚åœº | `market_type=100` | - | ç¾è‚¡éœ€è¦ |

---

## åã€æ³¨æ„äº‹é¡¹

### 1. æ¥å£é€‰æ‹©
- å¿…é¡»æ ¹æ®å¸‚åœºç±»å‹é€‰æ‹©æ­£ç¡®çš„æ¥å£
- å®¢æˆ·ç«¯å·²è‡ªåŠ¨å¤„ç†ï¼Œç”¨æˆ·æ— éœ€å…³å¿ƒ

### 2. å‚æ•°å·®å¼‚
- ç¾è‚¡å–å‡ºå¿…é¡»ä½¿ç”¨ `side=A`
- Aè‚¡/æ¸¯è‚¡å–å‡ºä½¿ç”¨ `side=S`
- å®¢æˆ·ç«¯å·²è‡ªåŠ¨è½¬æ¢

### 3. ç‰¹æ®Šå‚æ•°
- ç¾è‚¡éœ€è¦ `period_type` å‚æ•°
- Aè‚¡/æ¸¯è‚¡éœ€è¦ `security_type` å‚æ•°
- å®¢æˆ·ç«¯å·²è‡ªåŠ¨æ·»åŠ 

### 4. æ’¤å•å·®å¼‚
- ç¾è‚¡æ’¤å•éœ€è¦ `market_type` å‚æ•°
- Aè‚¡/æ¸¯è‚¡æ’¤å•ä¸éœ€è¦
- å®¢æˆ·ç«¯å·²è‡ªåŠ¨å¤„ç†

---

## åä¸€ã€æµ‹è¯•å»ºè®®

### å®Œæ•´æµ‹è¯•æµç¨‹

```python
# 1. æµ‹è¯•ç¾è‚¡ä¹°å…¥
result = await client.place_order(TradeRequest(
    stock_code="AAPL",
    market_type="US",
    side="BUY",
    ...
))

# 2. æµ‹è¯•ç¾è‚¡å–å‡º
result = await client.place_order(TradeRequest(
    stock_code="AAPL",
    market_type="US",
    side="SELL",  # è‡ªåŠ¨è½¬æ¢ä¸º side=A
    ...
))

# 3. æµ‹è¯•ç¾è‚¡æ’¤å•
result = await client.cancel_order(
    order_id="...",
    market_type="US"  # è‡ªåŠ¨ä½¿ç”¨ cancelIntegratedOrder
)

# 4. æµ‹è¯•Aè‚¡ä¹°å…¥
result = await client.place_order(TradeRequest(
    stock_code="601988",
    market_type="CN",
    side="BUY",
    ...
))

# 5. æµ‹è¯•Aè‚¡å–å‡º
result = await client.place_order(TradeRequest(
    stock_code="601988",
    market_type="CN",
    side="SELL",  # è‡ªåŠ¨è½¬æ¢ä¸º side=S
    ...
))

# 6. æµ‹è¯•Aè‚¡æ’¤å•
result = await client.cancel_order(
    order_id="...",
    market_type="CN"  # è‡ªåŠ¨ä½¿ç”¨ cancelOrder
)
```

---

## åäºŒã€é¡¹ç›®æˆæœ

### æ ¸å¿ƒæˆå°± ğŸ‰

1. âœ… **å‘ç°å¹¶è§£å†³äº†å¸‚åœºæ¥å£å·®å¼‚é—®é¢˜**
2. âœ… **å®ç°äº†æ™ºèƒ½æ¥å£è·¯ç”±ç³»ç»Ÿ**
3. âœ… **æä¾›äº†ç»Ÿä¸€çš„ç”¨æˆ·API**
4. âœ… **å®Œæ•´æ”¯æŒä¸‰ä¸ªå¸‚åœºçš„æ‰€æœ‰äº¤æ˜“åŠŸèƒ½**
5. âœ… **åˆ›å»ºäº†è¯¦ç»†çš„æ–‡æ¡£å’Œæµ‹è¯•**

### æŠ€æœ¯ä»·å€¼

- **å¯æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°å¸‚åœºæ”¯æŒ
- **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„ä»£ç ç»“æ„
- **æ˜“ç”¨æ€§**: ç»Ÿä¸€çš„APIæ¥å£
- **å¯é æ€§**: å®Œæ•´çš„é”™è¯¯å¤„ç†

---

## åä¸‰ã€å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…
```bash
pip install -r requirements.txt
```

### 2. é…ç½®
```bash
cp .env.example .env
# ç¼–è¾‘ .envï¼Œå¡«å…¥Cookieå’Œè´¦æˆ·ID
```

### 3. ä½¿ç”¨
```python
from futu_client import FutuClient
from models import TradeRequest

client = FutuClient()

# ä¹°å…¥ï¼ˆä»»æ„å¸‚åœºï¼‰
result = await client.place_order(TradeRequest(
    stock_code="AAPL",  # æˆ– "601988" æˆ– "00700"
    market_type="US",   # æˆ– "CN" æˆ– "HK"
    side="BUY",
    order_type="LIMIT",
    price=180.0,
    quantity=10,
    security_type="STOCK"
))

# å–å‡ºï¼ˆä»»æ„å¸‚åœºï¼‰
result = await client.place_order(TradeRequest(
    ...
    side="SELL",  # è‡ªåŠ¨è½¬æ¢ä¸ºæ­£ç¡®çš„å‚æ•°
    ...
))

# æ’¤å•ï¼ˆä»»æ„å¸‚åœºï¼‰
result = await client.cancel_order(
    order_id="123456789",
    market_type="US"  # è‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„æ¥å£
)
```

---

## åå››ã€æ€»ç»“

### é¡¹ç›®çŠ¶æ€
ğŸ‰ **å®Œå…¨å®Œæˆï¼ç”Ÿäº§å°±ç»ªï¼**

### æ”¯æŒçš„åŠŸèƒ½
- âœ… ä¸‰ä¸ªå¸‚åœºï¼ˆç¾è‚¡ã€Aè‚¡ã€æ¸¯è‚¡ï¼‰
- âœ… æ‰€æœ‰äº¤æ˜“æ“ä½œï¼ˆä¹°å…¥ã€å–å‡ºã€æ’¤å•ï¼‰
- âœ… æ™ºèƒ½æ¥å£è·¯ç”±
- âœ… ç»Ÿä¸€çš„ç”¨æˆ·API
- âœ… å®Œæ•´çš„æ–‡æ¡£
- âœ… æµ‹è¯•è„šæœ¬

### æŠ€æœ¯ç‰¹ç‚¹
- ğŸš€ è‡ªåŠ¨æ¥å£é€‰æ‹©
- ğŸ”„ å‚æ•°è‡ªåŠ¨è½¬æ¢
- ğŸ›¡ï¸ å®Œæ•´é”™è¯¯å¤„ç†
- ğŸ“ è¯¦ç»†æ—¥å¿—è®°å½•
- ğŸ¯ ç±»å‹å®‰å…¨

### ä½¿ç”¨ä½“éªŒ
- ç®€å•æ˜“ç”¨
- æ— éœ€å…³å¿ƒåº•å±‚å·®å¼‚
- ç»Ÿä¸€çš„è°ƒç”¨æ–¹å¼
- æ¸…æ™°çš„é”™è¯¯æç¤º

---

## ğŸŠ é¡¹ç›®å®Œæˆï¼

æ„Ÿè°¢ä½¿ç”¨å¯Œé€”æ¨¡æ‹Ÿäº¤æ˜“APIï¼

ç¥äº¤æ˜“é¡ºåˆ©ï¼ğŸ“ˆğŸ’°
