# å¯Œé€”æ¨¡æ‹Ÿäº¤æ˜“API - é‡è¦æ›´æ–°è¯´æ˜

## æ›´æ–°æ—¶é—´
2025-11-01

## ğŸ”„ é‡è¦å˜æ›´

### 1. ç»Ÿä¸€å–å‡ºå‚æ•° âœ…

**å˜æ›´å†…å®¹**:
- æ‰€æœ‰å¸‚åœºï¼ˆç¾è‚¡ã€Aè‚¡ã€æ¸¯è‚¡ï¼‰ç»Ÿä¸€ä½¿ç”¨ `side=A` è¡¨ç¤ºå–å‡º
- ä¹‹å‰é”™è¯¯åœ°è®¤ä¸ºAè‚¡/æ¸¯è‚¡ä½¿ç”¨ `side=S`ï¼Œå®é™…æµ‹è¯•å‘ç°ä¹Ÿæ˜¯ `side=A`

**å½±å“**:
- ä»£ç æ›´ç®€æ´
- å‚æ•°ç»Ÿä¸€ï¼Œé™ä½å¤æ‚åº¦
- ç”¨æˆ·ä½“éªŒæ›´å¥½

### 2. ç§»é™¤é»˜è®¤è´¦æˆ·é…ç½® âœ…

**å˜æ›´å†…å®¹**:
- ç§»é™¤ `ACCOUNT_ID` é»˜è®¤è´¦æˆ·é…ç½®
- å¿…é¡»ä¸ºæ¯ä¸ªå¸‚åœºå•ç‹¬é…ç½®è´¦æˆ·ID

**å½±å“**:
- æ›´æ˜ç¡®çš„è´¦æˆ·ç®¡ç†
- é¿å…è´¦æˆ·æ··æ·†
- å¼ºåˆ¶ç”¨æˆ·ä¸ºæ¯ä¸ªå¸‚åœºé…ç½®è´¦æˆ·

---

## æ›´æ–°è¯¦æƒ…

### é…ç½®æ–‡ä»¶å˜æ›´ (config.py)

#### ä¹‹å‰ âŒ
```python
# å¯Œé€”APIé…ç½®
FUTU_COOKIE = os.getenv("FUTU_COOKIE", "")
ACCOUNT_ID = os.getenv("ACCOUNT_ID", "")  # é»˜è®¤è´¦æˆ·

# è®¢å•æ–¹å‘
ORDER_SIDE = {
    "BUY": "B",
    "SELL": "S",  # é”™è¯¯ï¼šä»¥ä¸ºAè‚¡/æ¸¯è‚¡ç”¨S
}
```

#### ç°åœ¨ âœ…
```python
# å¯Œé€”APIé…ç½®
FUTU_COOKIE = os.getenv("FUTU_COOKIE", "")
# å·²ç§»é™¤ ACCOUNT_ID é»˜è®¤é…ç½®

# è®¢å•æ–¹å‘ï¼ˆæ‰€æœ‰å¸‚åœºç»Ÿä¸€ï¼‰
ORDER_SIDE = {
    "BUY": "B",
    "SELL": "A",  # æ­£ç¡®ï¼šæ‰€æœ‰å¸‚åœºç»Ÿä¸€ç”¨A
}
```

### å®¢æˆ·ç«¯ä»£ç å˜æ›´ (futu_client.py)

#### ä¹‹å‰ âŒ
```python
if market_type == "US":
    side_code = "B" if side == "BUY" else "A"  # ç¾è‚¡ç”¨A
else:
    side_code = ORDER_SIDE[side]  # Aè‚¡/æ¸¯è‚¡ç”¨S
```

#### ç°åœ¨ âœ…
```python
# æ‰€æœ‰å¸‚åœºç»Ÿä¸€ä½¿ç”¨ï¼šB=ä¹°å…¥, A=å–å‡º
side_code = ORDER_SIDE[side]

if market_type == "US":
    # ç¾è‚¡ä½¿ç”¨ inputIntegratedOrder
    order_data = {"side": side_code, ...}
else:
    # Aè‚¡/æ¸¯è‚¡ä½¿ç”¨ inputOrder
    order_data = {"side": side_code, ...}
```

---

## ç»Ÿä¸€çš„å‚æ•°è¡¨

### æ‰€æœ‰å¸‚åœºé€šç”¨

| æ“ä½œ | å‚æ•°å€¼ | è¯´æ˜ |
|------|--------|------|
| ä¹°å…¥ | `side=B` | Bid/Buy |
| å–å‡º | `side=A` | Ask/Sell |

### æ¥å£å·®å¼‚

| å¸‚åœº | ä¸‹å•æ¥å£ | æ’¤å•æ¥å£ |
|------|---------|---------|
| ç¾è‚¡ | `inputIntegratedOrder` | `cancelIntegratedOrder` |
| Aè‚¡ | `inputOrder` | `cancelOrder` |
| æ¸¯è‚¡ | `inputOrder` | `cancelOrder` |

---

## ä½¿ç”¨ç¤ºä¾‹

### ç»Ÿä¸€çš„è°ƒç”¨æ–¹å¼

```python
from futu_client import FutuClient
from models import TradeRequest

client = FutuClient()

# æ‰€æœ‰å¸‚åœºä½¿ç”¨ç›¸åŒçš„æ–¹å¼
for market, code in [("US", "AAPL"), ("CN", "601988"), ("HK", "00700")]:
    # ä¹°å…¥
    result = await client.place_order(TradeRequest(
        stock_code=code,
        market_type=market,
        side="BUY",      # ç»Ÿä¸€è½¬æ¢ä¸º side=B
        order_type="LIMIT",
        price=100.0,
        quantity=10,
        security_type="STOCK"
    ))
    
    # å–å‡º
    result = await client.place_order(TradeRequest(
        stock_code=code,
        market_type=market,
        side="SELL",     # ç»Ÿä¸€è½¬æ¢ä¸º side=A
        order_type="LIMIT",
        price=105.0,
        quantity=10,
        security_type="STOCK"
    ))
```

---

## é…ç½®è¦æ±‚

### ç¯å¢ƒå˜é‡ (.env)

```env
# å¯Œé€”Cookieï¼ˆå¿…éœ€ï¼‰
FUTU_COOKIE=your_cookie_here

# å„å¸‚åœºè´¦æˆ·IDï¼ˆæŒ‰éœ€é…ç½®ï¼‰
ACCOUNT_ID_US=16992013      # ç¾è‚¡è´¦æˆ·
ACCOUNT_ID_HK=9393          # æ¸¯è‚¡è´¦æˆ·
ACCOUNT_ID_CN=3182575       # Aè‚¡è´¦æˆ·
```

**é‡è¦æç¤º**:
- âŒ ä¸å†æ”¯æŒ `ACCOUNT_ID` é»˜è®¤é…ç½®
- âœ… å¿…é¡»ä¸ºæ¯ä¸ªè¦äº¤æ˜“çš„å¸‚åœºå•ç‹¬é…ç½®è´¦æˆ·ID
- âš ï¸ æœªé…ç½®è´¦æˆ·IDçš„å¸‚åœºæ— æ³•è¿›è¡Œäº¤æ˜“

---

## è¿ç§»æŒ‡å—

### å¦‚æœä½ ä¹‹å‰ä½¿ç”¨äº†é»˜è®¤è´¦æˆ·é…ç½®

#### æ­¥éª¤1: æ£€æŸ¥ç°æœ‰é…ç½®
```bash
# æŸ¥çœ‹ .env æ–‡ä»¶
cat .env
```

#### æ­¥éª¤2: æ›´æ–°é…ç½®
```env
# åˆ é™¤è¿™è¡Œï¼ˆå¦‚æœå­˜åœ¨ï¼‰
# ACCOUNT_ID=xxxxx

# æ·»åŠ å¸‚åœºä¸“ç”¨é…ç½®
ACCOUNT_ID_US=your_us_account_id
ACCOUNT_ID_HK=your_hk_account_id
ACCOUNT_ID_CN=your_cn_account_id
```

#### æ­¥éª¤3: æ›´æ–°ä»£ç 
```python
# ä¹‹å‰ï¼ˆä¸å†æ”¯æŒï¼‰
client = FutuClient()
result = await client.place_order(...)  # ä½¿ç”¨é»˜è®¤è´¦æˆ·

# ç°åœ¨ï¼ˆå¿…é¡»æŒ‡å®šå¸‚åœºï¼‰
client = FutuClient()
result = await client.place_order(TradeRequest(
    market_type="US",  # å¿…é¡»æŒ‡å®šå¸‚åœºç±»å‹
    ...
))
```

---

## ä¼˜åŠ¿

### 1. å‚æ•°ç»Ÿä¸€ âœ…
- æ‰€æœ‰å¸‚åœºä½¿ç”¨ç›¸åŒçš„ä¹°å–å‚æ•°
- ä»£ç æ›´ç®€æ´
- æ˜“äºç†è§£å’Œç»´æŠ¤

### 2. é…ç½®æ˜ç¡® âœ…
- æ¯ä¸ªå¸‚åœºç‹¬ç«‹é…ç½®
- é¿å…è´¦æˆ·æ··æ·†
- æ›´å®‰å…¨çš„è´¦æˆ·ç®¡ç†

### 3. ä»£ç ç®€åŒ– âœ…
- å‡å°‘æ¡ä»¶åˆ¤æ–­
- ç»Ÿä¸€çš„å¤„ç†é€»è¾‘
- æ›´å¥½çš„å¯ç»´æŠ¤æ€§

---

## æµ‹è¯•éªŒè¯

### éªŒè¯æ–¹æ³•

```python
import asyncio
from futu_client import FutuClient
from models import TradeRequest

async def test_unified_params():
    """æµ‹è¯•ç»Ÿä¸€å‚æ•°"""
    client = FutuClient()
    
    # æµ‹è¯•æ‰€æœ‰å¸‚åœºçš„ä¹°å…¥å’Œå–å‡º
    markets = [
        ("US", "AAPL", 180.0),
        ("CN", "601988", 5.61),
        ("HK", "00700", 400.0)
    ]
    
    for market, code, price in markets:
        print(f"\næµ‹è¯• {market} å¸‚åœº:")
        
        # ä¹°å…¥
        buy_result = await client.place_order(TradeRequest(
            stock_code=code,
            market_type=market,
            side="BUY",
            order_type="LIMIT",
            price=price,
            quantity=10,
            security_type="STOCK"
        ))
        print(f"  ä¹°å…¥: {buy_result.success}")
        
        # å–å‡º
        sell_result = await client.place_order(TradeRequest(
            stock_code=code,
            market_type=market,
            side="SELL",
            order_type="LIMIT",
            price=price * 1.01,
            quantity=10,
            security_type="STOCK"
        ))
        print(f"  å–å‡º: {sell_result.success}")

asyncio.run(test_unified_params())
```

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆè¦ç»Ÿä¸€å–å‡ºå‚æ•°ï¼Ÿ
A: ç»è¿‡å®é™…æµ‹è¯•å‘ç°ï¼Œæ‰€æœ‰å¸‚åœºéƒ½ä½¿ç”¨ `side=A` è¡¨ç¤ºå–å‡ºï¼Œç»Ÿä¸€å‚æ•°å¯ä»¥ç®€åŒ–ä»£ç å’Œæé«˜å¯ç»´æŠ¤æ€§ã€‚

### Q2: ä¸ºä»€ä¹ˆç§»é™¤é»˜è®¤è´¦æˆ·é…ç½®ï¼Ÿ
A: ä¸ºäº†é¿å…è´¦æˆ·æ··æ·†å’Œæé«˜å®‰å…¨æ€§ï¼Œè¦æ±‚ç”¨æˆ·ä¸ºæ¯ä¸ªå¸‚åœºæ˜ç¡®é…ç½®è´¦æˆ·IDã€‚

### Q3: å¦‚ä½•è·å–å„å¸‚åœºçš„è´¦æˆ·IDï¼Ÿ
A: è¿è¡Œæµ‹è¯•è„šæœ¬æˆ–ä½¿ç”¨ `get_account_list()` æ–¹æ³•æŸ¥è¯¢æ‰€æœ‰è´¦æˆ·ã€‚

### Q4: æœªé…ç½®è´¦æˆ·çš„å¸‚åœºèƒ½äº¤æ˜“å—ï¼Ÿ
A: ä¸èƒ½ã€‚ç³»ç»Ÿä¼šè¿”å›é”™è¯¯æç¤ºï¼Œè¦æ±‚å…ˆé…ç½®è¯¥å¸‚åœºçš„è´¦æˆ·IDã€‚

### Q5: éœ€è¦æ›´æ–°ç°æœ‰ä»£ç å—ï¼Ÿ
A: å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ç»Ÿä¸€çš„ `place_order()` APIï¼Œä¸éœ€è¦æ›´æ–°ã€‚å¦‚æœç›´æ¥ä½¿ç”¨äº† `ORDER_SIDE` é…ç½®ï¼Œéœ€è¦æ³¨æ„å–å‡ºå‚æ•°å·²ä» `S` æ”¹ä¸º `A`ã€‚

---

## æ›´æ–°æ¸…å•

### å·²æ›´æ–°æ–‡ä»¶
- [x] `config.py` - ç§»é™¤é»˜è®¤è´¦æˆ·ï¼Œç»Ÿä¸€å–å‡ºå‚æ•°
- [x] `futu_client.py` - ç®€åŒ–æ¥å£é€‰æ‹©é€»è¾‘
- [x] `æ¥å£ç»Ÿä¸€è¯´æ˜.md` - æ–°å¢ç»Ÿä¸€è¯´æ˜æ–‡æ¡£
- [x] `é‡è¦æ›´æ–°è¯´æ˜.md` - æœ¬æ–‡æ¡£

### æ— éœ€æ›´æ–°æ–‡ä»¶
- [x] `.env.example` - å·²ç»æ˜¯æ­£ç¡®çš„æ ¼å¼
- [x] `models.py` - æ— éœ€æ›´æ”¹
- [x] æµ‹è¯•è„šæœ¬ - ä½¿ç”¨ç»Ÿä¸€APIï¼Œæ— éœ€æ›´æ”¹

---

## æ€»ç»“

âœ… **æ›´ç®€å•**: æ‰€æœ‰å¸‚åœºä½¿ç”¨ç»Ÿä¸€çš„ä¹°å–å‚æ•°
âœ… **æ›´æ˜ç¡®**: æ¯ä¸ªå¸‚åœºç‹¬ç«‹é…ç½®è´¦æˆ·
âœ… **æ›´å®‰å…¨**: é¿å…è´¦æˆ·æ··æ·†
âœ… **æ›´æ˜“ç»´æŠ¤**: ä»£ç é€»è¾‘æ›´æ¸…æ™°

ğŸ‰ **å‡çº§å®Œæˆï¼ç³»ç»Ÿç°åœ¨æ›´åŠ ç»Ÿä¸€å’Œæ˜“ç”¨ï¼**
