# å¯Œé€”APIå“åº”åˆ†æ

## ğŸ” æµ‹è¯•ç»“æœ

é€šè¿‡è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ï¼Œæˆ‘ä»¬è·å–åˆ°äº†å¯Œé€”APIçš„å®Œæ•´å“åº”ä¿¡æ¯ã€‚

---

## ğŸ“Š æ¥å£å“åº”è¯¦æƒ…

### 1. è´¦æˆ·ä¿¡æ¯æ¥å£

**è¯·æ±‚**:
```
URL: https://www.futunn.com/paper-trade/common-api
Method: GET
Params: {
  "_m": "getAccountDetail",
  "account_id": "16992013"
}
```

**å“åº”**:
```json
{
  "code": -1,
  "message": "Invalid Method",
  "data": []
}
```

**åˆ†æ**:
- âŒ æ–¹æ³•å `getAccountDetail` æ— æ•ˆ
- å¯Œé€”APIè¿”å› "Invalid Method" é”™è¯¯
- è¯´æ˜è¿™ä¸ªæ–¹æ³•åå¯èƒ½å·²ç»æ”¹å˜æˆ–åºŸå¼ƒ

---

### 2. æŒä»“åˆ—è¡¨æ¥å£

**è¯·æ±‚**:
```
URL: https://www.futunn.com/paper-trade/common-api
Method: GET
Params: {
  "_m": "getIntegratedPosList",
  "account_id": "16992013"
}
```

**å“åº”**:
```json
{
  "code": -1,
  "message": "Invalid Method",
  "data": []
}
```

**åˆ†æ**:
- âŒ æ–¹æ³•å `getIntegratedPosList` æ— æ•ˆ
- åŒæ ·è¿”å› "Invalid Method" é”™è¯¯
- è¿™ä¸ªæ–¹æ³•åä¹Ÿå¯èƒ½å·²ç»æ”¹å˜

---

### 3. è‚¡ç¥¨æœç´¢æ¥å£

**è¯·æ±‚**:
```
URL: https://www.futunn.com/search-stock/search
Method: GET
Params: {
  "keyword": "AAPL",
  "lang": "zh-cn",
  "market_type": 100
}
```

**å“åº”**:
```
Content-Type: text/plain
Hello World
```

**åˆ†æ**:
- âŒ è¿”å›çº¯æ–‡æœ¬ "Hello World"
- ä¸æ˜¯JSONæ ¼å¼
- è¿™ä¸ªç«¯ç‚¹å¯èƒ½æ˜¯æµ‹è¯•ç«¯ç‚¹æˆ–å·²ç»ä¸å¯ç”¨

---

## âœ… æˆåŠŸçš„æ¥å£

### è®¢å•æŸ¥è¯¢æ¥å£

**è¯·æ±‚**:
```
URL: https://www.futunn.com/paper-trade/common-api
Method: GET
Params: {
  "_m": "getTradeHistoryOrders",
  "account_id": "16992013",
  "last_id": 0,
  "filter_status": 0,
  "side": "",
  "start_time": <timestamp>,
  "end_time": <timestamp>
}
```

**å“åº”**:
```json
[]
```

**åˆ†æ**:
- âœ… è¿™ä¸ªæ¥å£å·¥ä½œæ­£å¸¸
- è¿”å›ç©ºæ•°ç»„è¡¨ç¤ºå½“å‰æ²¡æœ‰è®¢å•
- è¯´æ˜ `getTradeHistoryOrders` æ–¹æ³•åæ˜¯æ­£ç¡®çš„

---

## ğŸ¯ ç»“è®º

### CookieçŠ¶æ€
- âœ… **Cookieæ˜¯æœ‰æ•ˆçš„**
- å¯Œé€”APIæœ‰æ­£å¸¸å“åº”ï¼Œåªæ˜¯æ–¹æ³•åä¸å¯¹

### é—®é¢˜æ ¹æº
- âŒ **æ–¹æ³•åå·²è¿‡æ—¶**
- `getAccountDetail` - æ— æ•ˆ
- `getIntegratedPosList` - æ— æ•ˆ
- `search-stock/search` ç«¯ç‚¹ - è¿”å› "Hello World"

### æœ‰æ•ˆçš„æ–¹æ³•
- âœ… `getTradeHistoryOrders` - æŸ¥è¯¢è®¢å•ï¼ˆæœ‰æ•ˆï¼‰

---

## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: æµè§ˆå™¨æŠ“åŒ…è·å–æ­£ç¡®çš„æ–¹æ³•åï¼ˆæ¨èï¼‰

**æ­¥éª¤**:

1. **æ‰“å¼€æµè§ˆå™¨**
   - è®¿é—® https://www.futunn.com/paper-trade
   - ç™»å½•è´¦æˆ·

2. **æ‰“å¼€å¼€å‘è€…å·¥å…·**
   - æŒ‰ F12
   - åˆ‡æ¢åˆ° Network (ç½‘ç»œ) æ ‡ç­¾
   - å‹¾é€‰ "Preserve log" (ä¿ç•™æ—¥å¿—)

3. **æ‰§è¡Œæ“ä½œå¹¶è®°å½•**
   
   **æŸ¥çœ‹è´¦æˆ·ä¿¡æ¯**:
   - åœ¨é¡µé¢ä¸ŠæŸ¥çœ‹è´¦æˆ·ä¿¡æ¯
   - åœ¨Networkæ ‡ç­¾ä¸­æ‰¾åˆ°ç›¸å…³è¯·æ±‚
   - è®°å½•ï¼š
     - URL
     - è¯·æ±‚å‚æ•°ï¼ˆç‰¹åˆ«æ˜¯ `_m` å‚æ•°ï¼‰
     - å“åº”æ ¼å¼
   
   **æŸ¥çœ‹æŒä»“**:
   - åœ¨é¡µé¢ä¸ŠæŸ¥çœ‹æŒä»“åˆ—è¡¨
   - è®°å½•ç›¸å…³è¯·æ±‚ä¿¡æ¯
   
   **æœç´¢è‚¡ç¥¨**:
   - åœ¨é¡µé¢ä¸Šæœç´¢è‚¡ç¥¨
   - è®°å½•æœç´¢æ¥å£çš„URLå’Œå‚æ•°

4. **æ›´æ–°ä»£ç **
   - åœ¨ `futu_client.py` ä¸­æ›´æ–°æ–¹æ³•å
   - æ›´æ–°URLå’Œå‚æ•°æ ¼å¼

**ç¤ºä¾‹ - å¦‚ä½•æŸ¥çœ‹è¯·æ±‚**:
```
1. åœ¨Networkæ ‡ç­¾ä¸­æ‰¾åˆ°è¯·æ±‚
2. ç‚¹å‡»è¯·æ±‚æŸ¥çœ‹è¯¦æƒ…
3. æŸ¥çœ‹ Headers æ ‡ç­¾:
   - Request URL: å®Œæ•´çš„URL
   - Query String Parameters: è¯·æ±‚å‚æ•°
4. æŸ¥çœ‹ Response æ ‡ç­¾:
   - æŸ¥çœ‹å“åº”æ ¼å¼
```

---

### æ–¹æ¡ˆ2: ä½¿ç”¨å¯Œé€”OpenD APIï¼ˆé•¿æœŸæ–¹æ¡ˆï¼‰

**ä¼˜ç‚¹**:
- å®˜æ–¹æ”¯æŒï¼Œç¨³å®šå¯é 
- ä¸ä¾èµ–Web API
- æ–‡æ¡£å®Œå–„
- ä¸éœ€è¦Cookie

**æ­¥éª¤**:

1. **å®‰è£…OpenD**
   - ä¸‹è½½: https://www.futunn.com/download/openAPI
   - å®‰è£…å¹¶å¯åŠ¨OpenDå®¢æˆ·ç«¯

2. **å®‰è£…Python SDK**
   ```bash
   pip install futu-api
   ```

3. **é‡æ„ä»£ç **
   ```python
   from futu import OpenQuoteContext, OpenSecTradeContext
   
   # è¡Œæƒ…ä¸Šä¸‹æ–‡
   quote_ctx = OpenQuoteContext(host='127.0.0.1', port=11111)
   
   # äº¤æ˜“ä¸Šä¸‹æ–‡
   trade_ctx = OpenSecTradeContext(host='127.0.0.1', port=11111)
   ```

4. **å‚è€ƒæ–‡æ¡£**
   - å®˜æ–¹æ–‡æ¡£: https://openapi.futunn.com/
   - GitHub: https://github.com/FutunnOpen/py-futu-api

---

### æ–¹æ¡ˆ3: ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰

åœ¨ `futu_client.py` ä¸­æ·»åŠ æ¨¡æ‹Ÿæ¨¡å¼ï¼š

```python
class FutuClient:
    def __init__(self, cookie: str = None, mock_mode: bool = False):
        self.mock_mode = mock_mode
        # ...
    
    async def get_account_info(self, market_type: str):
        if self.mock_mode:
            return AccountInfo(
                account_id="16992013",
                net_asset=1000000.00,
                cash=500000.00,
                market_value=500000.00,
                # ...
            )
        # å®é™…APIè°ƒç”¨
```

---

## ğŸ“ éœ€è¦æŠ“åŒ…çš„æ¥å£

å¦‚æœé€‰æ‹©æ–¹æ¡ˆ1ï¼Œéœ€è¦æŠ“åŒ…è·å–ä»¥ä¸‹æ¥å£çš„æ­£ç¡®æ–¹æ³•åï¼š

### 1. è´¦æˆ·ä¿¡æ¯
- **å½“å‰æ–¹æ³•**: `getAccountDetail` âŒ
- **éœ€è¦æ‰¾åˆ°**: æ­£ç¡®çš„æ–¹æ³•å
- **æ“ä½œ**: åœ¨é¡µé¢ä¸ŠæŸ¥çœ‹è´¦æˆ·ä¿¡æ¯

### 2. æŒä»“åˆ—è¡¨
- **å½“å‰æ–¹æ³•**: `getIntegratedPosList` âŒ
- **éœ€è¦æ‰¾åˆ°**: æ­£ç¡®çš„æ–¹æ³•å
- **æ“ä½œ**: åœ¨é¡µé¢ä¸ŠæŸ¥çœ‹æŒä»“åˆ—è¡¨

### 3. è‚¡ç¥¨æœç´¢
- **å½“å‰URL**: `/search-stock/search` âŒ
- **éœ€è¦æ‰¾åˆ°**: æ­£ç¡®çš„æœç´¢æ¥å£
- **æ“ä½œ**: åœ¨é¡µé¢ä¸Šæœç´¢è‚¡ç¥¨

### 4. è‚¡ç¥¨è¡Œæƒ…
- **å½“å‰æ–¹æ³•**: `batchGetSecurityQuote` â“
- **éœ€è¦éªŒè¯**: æ˜¯å¦æ­£ç¡®
- **æ“ä½œ**: åœ¨é¡µé¢ä¸ŠæŸ¥çœ‹è‚¡ç¥¨è¡Œæƒ…

### 5. ä¸‹å•äº¤æ˜“
- **å½“å‰æ–¹æ³•**: 
  - ç¾è‚¡: `inputIntegratedOrder`
  - æ¸¯è‚¡/Aè‚¡: `inputOrder`
- **éœ€è¦éªŒè¯**: æ˜¯å¦æ­£ç¡®
- **æ“ä½œ**: åœ¨é¡µé¢ä¸Šå°è¯•ä¸‹å•ï¼ˆä¸å®é™…æäº¤ï¼‰

### 6. æ’¤å•
- **å½“å‰æ–¹æ³•**:
  - ç¾è‚¡: `cancelIntegratedOrder`
  - æ¸¯è‚¡/Aè‚¡: `cancelOrder`
- **éœ€è¦éªŒè¯**: æ˜¯å¦æ­£ç¡®
- **æ“ä½œ**: åœ¨é¡µé¢ä¸Šå°è¯•æ’¤å•

---

## ğŸ”§ å¦‚ä½•æ›´æ–°ä»£ç 

æ‰¾åˆ°æ­£ç¡®çš„æ–¹æ³•ååï¼Œåœ¨ `futu_client.py` ä¸­æ›´æ–°ï¼š

```python
# ç¤ºä¾‹ï¼šæ›´æ–°è´¦æˆ·ä¿¡æ¯æ–¹æ³•
async def get_account_info(self, market_type: str):
    url = f"{FUTU_BASE_URL}/paper-trade/common-api"
    params = {
        "_m": "æ–°çš„æ–¹æ³•å",  # æ›´æ–°è¿™é‡Œ
        "account_id": account_id
    }
    data = await self._request("GET", url, params=params)
    # ...
```

---

## ğŸ“Š å½“å‰çŠ¶æ€æ€»ç»“

| æ¥å£ | æ–¹æ³•å | çŠ¶æ€ | è¯´æ˜ |
|------|--------|------|------|
| è´¦æˆ·ä¿¡æ¯ | getAccountDetail | âŒ æ— æ•ˆ | éœ€è¦æ›´æ–° |
| æŒä»“åˆ—è¡¨ | getIntegratedPosList | âŒ æ— æ•ˆ | éœ€è¦æ›´æ–° |
| è‚¡ç¥¨æœç´¢ | /search-stock/search | âŒ æ— æ•ˆ | éœ€è¦æ›´æ–° |
| è®¢å•æŸ¥è¯¢ | getTradeHistoryOrders | âœ… æœ‰æ•ˆ | æ­£å¸¸å·¥ä½œ |
| ä¸‹å•äº¤æ˜“ | inputIntegratedOrder / inputOrder | â“ æœªæµ‹è¯• | éœ€è¦éªŒè¯ |
| æ’¤å• | cancelIntegratedOrder / cancelOrder | â“ æœªæµ‹è¯• | éœ€è¦éªŒè¯ |

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¯åš
1. âœ… ç¡®è®¤Cookieæœ‰æ•ˆ
2. âœ… ç¡®è®¤é—®é¢˜æ ¹æºï¼ˆæ–¹æ³•åè¿‡æ—¶ï¼‰
3. âœ… ç¡®è®¤è®¢å•æŸ¥è¯¢æ¥å£æ­£å¸¸

### éœ€è¦å†³å®š
é€‰æ‹©ä»¥ä¸‹æ–¹æ¡ˆä¹‹ä¸€ï¼š
1. **æµè§ˆå™¨æŠ“åŒ…** - è·å–æ­£ç¡®çš„æ–¹æ³•åï¼ˆå¿«é€Ÿï¼‰
2. **ä½¿ç”¨OpenD API** - åˆ‡æ¢åˆ°å®˜æ–¹APIï¼ˆç¨³å®šï¼‰
3. **ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®** - ä¸´æ—¶æ–¹æ¡ˆï¼ˆå¼€å‘æµ‹è¯•ï¼‰

### æ¨èæ–¹æ¡ˆ
- **çŸ­æœŸ**: æµè§ˆå™¨æŠ“åŒ…æ›´æ–°æ–¹æ³•å
- **é•¿æœŸ**: åˆ‡æ¢åˆ°å¯Œé€”OpenD API

---

**åˆ†æå®Œæˆæ—¶é—´**: 2025-11-01 22:00  
**CookieçŠ¶æ€**: âœ… æœ‰æ•ˆ  
**é—®é¢˜æ ¹æº**: âŒ APIæ–¹æ³•åè¿‡æ—¶  
**è§£å†³æ–¹æ¡ˆ**: æµè§ˆå™¨æŠ“åŒ…æˆ–ä½¿ç”¨OpenD API
