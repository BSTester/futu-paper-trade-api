# 富途模拟交易API服务 - 项目说明

## 📦 项目概述

已成功创建一个完整的富途模拟交易API服务，支持美股、港股、A股的模拟交易操作。

**项目位置**: `futu-paper-trade-api/`

## ✨ 核心功能

### 1. 账户管理
- ✅ 获取账户列表
- ✅ 查询账户详情（资产净值、现金、持仓市值等）
- ✅ 实时账户数据更新

### 2. 持仓查询
- ✅ 查询所有持仓
- ✅ 查看持仓盈亏
- ✅ 持仓详细信息（成本价、当前价、盈亏比例）

### 3. 行情查询
- ✅ 搜索股票（支持代码和名称）
- ✅ 获取实时行情
- ✅ 获取热门股票榜单
- ✅ 支持批量查询

### 4. 模拟交易
- ✅ 买入股票（限价单/市价单）
- ✅ 卖出股票（限价单/市价单）
- ✅ 支持美股、港股、A股
- ✅ 自动股票代码转换

## 🏗️ 项目结构

```
futu-paper-trade-api/
├── main.py                 # FastAPI主程序，定义所有API接口
├── futu_client.py          # 富途API客户端，封装所有业务逻辑
├── models.py               # Pydantic数据模型定义
├── config.py               # 配置文件，包含市场类型等常量
├── requirements.txt        # Python依赖包列表
├── .env.example            # 环境变量示例文件
├── .gitignore             # Git忽略文件配置
│
├── README.md              # 项目完整说明文档
├── API接口说明.md          # 详细的API接口文档
├── 快速开始指南.md         # 5分钟快速上手指南
│
├── setup.bat              # Windows初始化脚本
├── start.bat              # Windows启动脚本
├── test_api.py            # API功能测试脚本
└── example_usage.py       # Python使用示例代码
```

## 🎯 技术栈

- **FastAPI**: 现代化的Python Web框架，自动生成API文档
- **Pydantic**: 数据验证和序列化
- **httpx**: 异步HTTP客户端，用于调用富途API
- **uvicorn**: 高性能ASGI服务器
- **python-dotenv**: 环境变量管理

## 🚀 快速开始

### 1. 安装依赖
```bash
cd futu-paper-trade-api
pip install -r requirements.txt
```

或双击运行 `setup.bat`

### 2. 配置环境变量

复制 `.env.example` 为 `.env`，填入配置：

```env
FUTU_COOKIE=你的Cookie值
ACCOUNT_ID=你的账户ID
API_HOST=0.0.0.0
API_PORT=8000
```

**获取Cookie方法**：
1. 访问 https://www.futunn.com/paper-trade
2. 登录账户
3. F12打开开发者工具 → Network标签
4. 复制请求头中的Cookie字段

### 3. 启动服务
```bash
python main.py
```

或双击运行 `start.bat`

### 4. 访问API文档
- 交互式文档: http://localhost:8000/docs
- ReDoc文档: http://localhost:8000/redoc

## 📡 API接口示例

### 查询账户信息
```bash
curl http://localhost:8000/api/account/info
```

### 搜索股票
```bash
curl -X POST http://localhost:8000/api/stock/search \
  -H "Content-Type: application/json" \
  -d '{"keyword":"NVDA","market_type":"US"}'
```

### 买入股票
```bash
# 美股
curl -X POST "http://localhost:8000/api/trade/buy?stock_code=NVDA&market_type=US&quantity=10&price=202.50&order_type=LIMIT"

# 港股
curl -X POST "http://localhost:8000/api/trade/buy?stock_code=00700&market_type=HK&quantity=100&price=380.00&order_type=LIMIT"

# A股
curl -X POST "http://localhost:8000/api/trade/buy?stock_code=600519&market_type=CN&quantity=100&price=1650.00&order_type=LIMIT"
```

### 查询持仓
```bash
curl http://localhost:8000/api/positions
```

## 🌍 支持的市场

| 市场 | 代码 | 示例股票代码 |
|------|------|-------------|
| 美股 | US   | NVDA, AAPL, TSLA, MSFT |
| 港股 | HK   | 00700 (腾讯), 09988 (阿里) |
| A股  | CN   | 600519 (茅台), 000001 (平安) |

## 📝 核心文件说明

### main.py
FastAPI应用主程序，定义了所有API端点：
- 系统接口：健康检查、根路径
- 账户接口：账户列表、账户详情
- 持仓接口：持仓查询
- 行情接口：搜索股票、获取行情、热门股票
- 交易接口：下单、买入、卖出

### futu_client.py
富途API客户端，封装了所有与富途服务器的交互：
- `get_account_list()`: 获取账户列表
- `get_account_info()`: 获取账户详情
- `get_positions()`: 获取持仓列表
- `search_stock()`: 搜索股票
- `get_stock_quote()`: 获取股票行情
- `place_order()`: 下单交易
- `get_hot_stocks()`: 获取热门股票

### models.py
数据模型定义，使用Pydantic进行数据验证：
- `AccountInfo`: 账户信息模型
- `Position`: 持仓信息模型
- `StockQuote`: 股票行情模型
- `TradeRequest`: 交易请求模型
- `TradeResponse`: 交易响应模型
- `StockSearchResult`: 股票搜索结果模型

### config.py
配置文件，包含：
- 环境变量加载
- API端点配置
- 市场类型映射
- 订单类型映射
- 证券类型映射

## 🔍 API接口列表

### 系统接口
- `GET /` - 根路径
- `GET /health` - 健康检查

### 账户接口
- `GET /api/accounts` - 获取账户列表
- `GET /api/account/info` - 获取账户详情

### 持仓接口
- `GET /api/positions` - 获取持仓列表

### 行情接口
- `POST /api/stock/search` - 搜索股票
- `GET /api/stock/quote` - 获取股票行情
- `GET /api/stock/hot` - 获取热门股票

### 交易接口
- `POST /api/trade` - 下单交易（完整接口）
- `POST /api/trade/buy` - 快速买入
- `POST /api/trade/sell` - 快速卖出

## 🧪 测试和示例

### 运行API测试
```bash
python test_api.py
```

测试内容：
- ✅ 健康检查
- ✅ 获取账户列表
- ✅ 获取账户信息
- ✅ 获取持仓列表
- ✅ 搜索股票（美股、港股、A股）
- ✅ 获取热门股票

### 运行使用示例
```bash
python example_usage.py
```

示例内容：
- 查询账户信息
- 查询持仓
- 搜索股票
- 获取热门股票
- 买入股票（限价单/市价单）
- 卖出股票
- 多市场交易

## ⚙️ 配置说明

### 环境变量
- `FUTU_COOKIE`: 富途账户Cookie（必填）
- `ACCOUNT_ID`: 模拟交易账户ID（必填）
- `API_HOST`: API服务监听地址（默认0.0.0.0）
- `API_PORT`: API服务端口（默认8000）

### 市场类型
- `US`: 美股（market_type=100）
- `HK`: 港股（market_type=1）
- `CN`: A股（market_type=2）

### 订单类型
- `LIMIT`: 限价单（需要指定价格）
- `MARKET`: 市价单（按当前市价成交）

### 交易方向
- `BUY`: 买入
- `SELL`: 卖出

## 🔒 安全注意事项

1. **Cookie保护**: Cookie包含敏感信息，不要泄露或提交到代码仓库
2. **仅限模拟**: 本服务仅用于模拟交易，不涉及真实资金
3. **Cookie过期**: Cookie会过期，需要定期更新
4. **请求频率**: 建议控制请求频率，避免被限流

## 📚 文档说明

- **README.md**: 项目完整说明，包含功能特性、安装步骤、使用示例
- **API接口说明.md**: 详细的API接口文档，包含所有接口的参数和响应格式
- **快速开始指南.md**: 5分钟快速上手指南，适合新手
- **项目说明.md**: 本文件，项目总体说明

## 🎯 使用场景

1. **量化交易策略测试**: 在模拟环境中测试交易策略
2. **交易机器人开发**: 开发自动化交易程序
3. **投资组合管理**: 管理和跟踪模拟投资组合
4. **学习交易API**: 学习如何使用API进行股票交易
5. **多市场交易**: 同时管理美股、港股、A股投资

## ⚠️ 注意事项

1. **模拟交易**: 本服务仅支持模拟交易，不能用于实盘
2. **数据延迟**: 行情数据可能有延迟
3. **Cookie管理**: 需要定期更新Cookie
4. **API稳定性**: Web API可能会变动，建议使用富途官方OpenAPI
5. **风险提示**: 模拟交易结果不代表真实交易结果

## 🔄 后续优化建议

1. **添加订单管理**: 查询订单状态、撤单等功能
2. **添加历史记录**: 交易历史、资金流水等
3. **添加数据分析**: K线图、技术指标等
4. **添加风险控制**: 止损、止盈等功能
5. **添加通知功能**: 交易通知、价格提醒等
6. **数据库支持**: 持久化交易记录
7. **WebSocket支持**: 实时行情推送
8. **用户认证**: 多用户支持

## 📞 支持

如有问题，请查看：
1. 项目文档（README.md、API接口说明.md）
2. 快速开始指南（快速开始指南.md）
3. 运行测试脚本（test_api.py）
4. 查看示例代码（example_usage.py）

## 📄 许可证

MIT License

---

**项目创建完成！** 🎉

现在你可以：
1. 进入 `futu-paper-trade-api` 目录
2. 运行 `setup.bat` 初始化项目
3. 配置 `.env` 文件
4. 运行 `start.bat` 启动服务
5. 访问 http://localhost:8000/docs 查看API文档
6. 开始你的模拟交易之旅！
