# æ›´æ–°è¯´æ˜ - è‡ªåŠ¨è´¦æˆ·åŒ¹é…åŠŸèƒ½

## ğŸ‰ æ–°åŠŸèƒ½ï¼šæ ¹æ®å¸‚åœºç±»å‹è‡ªåŠ¨åŒ¹é…è´¦æˆ·

### é—®é¢˜èƒŒæ™¯

å¯Œé€”æ¨¡æ‹Ÿäº¤æ˜“ç³»ç»Ÿä¸­ï¼Œä¸åŒå¸‚åœºï¼ˆç¾è‚¡ã€æ¸¯è‚¡ã€Aè‚¡ï¼‰ä½¿ç”¨ä¸åŒçš„è´¦æˆ·IDï¼š
- **ç¾è‚¡è´¦æˆ·**: ç”¨äºäº¤æ˜“ç¾è‚¡ï¼ˆå¦‚ NVDA, AAPLï¼‰
- **æ¸¯è‚¡è´¦æˆ·**: ç”¨äºäº¤æ˜“æ¸¯è‚¡ï¼ˆå¦‚ 00700, 09988ï¼‰
- **Aè‚¡è´¦æˆ·**: ç”¨äºäº¤æ˜“Aè‚¡ï¼ˆå¦‚ 600519, 000001ï¼‰
- **æ¯”èµ›è´¦æˆ·**: ç‰¹æ®Šçš„æ¯”èµ›è´¦æˆ·ï¼ˆé€šå¸¸æ˜¯ç¾è‚¡ï¼‰

ä¹‹å‰çš„å®ç°éœ€è¦ç”¨æˆ·æ‰‹åŠ¨æŒ‡å®šè´¦æˆ·IDï¼Œä¸å¤Ÿæ™ºèƒ½ã€‚

### è§£å†³æ–¹æ¡ˆ

ç°åœ¨ç³»ç»Ÿä¼š**è‡ªåŠ¨æ ¹æ®è‚¡ç¥¨ä»£ç çš„å¸‚åœºç±»å‹åŒ¹é…å¯¹åº”çš„è´¦æˆ·**ï¼Œæ— éœ€æ‰‹åŠ¨æŒ‡å®šï¼

## ğŸ“‹ æ›´æ–°å†…å®¹

### 1. è´¦æˆ·è‡ªåŠ¨åŒ¹é…

ç³»ç»Ÿå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨è·å–æ‰€æœ‰è´¦æˆ·ä¿¡æ¯ï¼Œå¹¶å»ºç«‹å¸‚åœºç±»å‹ä¸è´¦æˆ·IDçš„æ˜ å°„å…³ç³»ï¼š

```python
# è´¦æˆ·æ˜ å°„ç¤ºä¾‹
{
    "HK": "9393",        # æ¸¯è‚¡è´¦æˆ·
    "US": "16992013",    # ç¾è‚¡è´¦æˆ·
    "CN": "12345",       # Aè‚¡è´¦æˆ·
}
```

### 2. æ™ºèƒ½äº¤æ˜“

ä¸‹å•æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. æ ¹æ®è‚¡ç¥¨ä»£ç æœç´¢è‚¡ç¥¨
2. è¯†åˆ«è‚¡ç¥¨æ‰€å±å¸‚åœº
3. è‡ªåŠ¨é€‰æ‹©å¯¹åº”å¸‚åœºçš„è´¦æˆ·
4. æäº¤è®¢å•

**ç¤ºä¾‹**ï¼š
```bash
# ä¹°å…¥ç¾è‚¡ NVDA - è‡ªåŠ¨ä½¿ç”¨ç¾è‚¡è´¦æˆ·
POST /api/trade/buy?stock_code=NVDA&market_type=US&quantity=10&price=202.50

# ä¹°å…¥æ¸¯è‚¡è…¾è®¯ - è‡ªåŠ¨ä½¿ç”¨æ¸¯è‚¡è´¦æˆ·
POST /api/trade/buy?stock_code=00700&market_type=HK&quantity=100&price=380.00

# ä¹°å…¥Aè‚¡èŒ…å° - è‡ªåŠ¨ä½¿ç”¨Aè‚¡è´¦æˆ·
POST /api/trade/buy?stock_code=600519&market_type=CN&quantity=100&price=1650.00
```

### 3. çµæ´»æŸ¥è¯¢

æŸ¥è¯¢è´¦æˆ·ä¿¡æ¯å’ŒæŒä»“æ—¶ï¼Œå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼ï¼š

**æ–¹å¼1ï¼šæŒ‡å®šè´¦æˆ·ID**
```bash
GET /api/account/info?account_id=9393
GET /api/positions?account_id=9393
```

**æ–¹å¼2ï¼šæŒ‡å®šå¸‚åœºç±»å‹ï¼ˆæ¨èï¼‰**
```bash
GET /api/account/info?market_type=HK
GET /api/positions?market_type=US
```

### 4. è´¦æˆ·åˆ—è¡¨å¢å¼º

`GET /api/accounts` æ¥å£ç°åœ¨è¿”å›æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼š

**ä¹‹å‰**ï¼š
```json
["9393", "16992013", "12345"]
```

**ç°åœ¨**ï¼š
```json
[
    {
        "account_id": "9393",
        "account_name": "æ¸¯è‚¡æ¨¡æ‹Ÿè´¦æˆ·",
        "market_type": "HK",
        "currency": "HKD",
        "attribute_market": 1
    },
    {
        "account_id": "16992013",
        "account_name": "ç¬¬äºŒå±Šå…¨çƒæ¨¡æ‹Ÿäº¤æ˜“å¤§èµ›",
        "market_type": "US",
        "currency": "USD",
        "attribute_market": 2
    },
    {
        "account_id": "12345",
        "account_name": "æ²ªæ·±å¸‚åœºæ¨¡æ‹Ÿäº¤æ˜“",
        "market_type": "CN",
        "currency": "CNY",
        "attribute_market": 3
    }
]
```

## ğŸ”§ æŠ€æœ¯å®ç°

### å¸‚åœºç±»å‹æ˜ å°„

**APIè¯·æ±‚ä¸­çš„market_type**ï¼ˆç”¨äºæŸ¥è¯¢è¡Œæƒ…ï¼‰ï¼š
```python
MARKET_TYPE = {
    "US": 100,  # ç¾è‚¡
    "HK": 1,    # æ¸¯è‚¡
    "CN": 2,    # Aè‚¡
    "JP": 4,    # æ—¥è‚¡
}
```

**è´¦æˆ·åˆ—è¡¨ä¸­çš„attribute_market**ï¼ˆç”¨äºè¯†åˆ«è´¦æˆ·ç±»å‹ï¼‰ï¼š
```python
ATTRIBUTE_MARKET = {
    1: "HK",  # æ¸¯è‚¡
    2: "US",  # ç¾è‚¡
    3: "CN",  # Aè‚¡
    4: "JP",  # æ—¥è‚¡
}
```

### æ ¸å¿ƒæ–¹æ³•

#### 1. `get_account_id_by_market(market_type)`
æ ¹æ®å¸‚åœºç±»å‹è·å–å¯¹åº”çš„è´¦æˆ·ID

```python
# è·å–æ¸¯è‚¡è´¦æˆ·ID
account_id = await client.get_account_id_by_market("HK")
# è¿”å›: "9393"
```

#### 2. `get_account_list()`
è·å–æ‰€æœ‰è´¦æˆ·ä¿¡æ¯å¹¶è‡ªåŠ¨å»ºç«‹æ˜ å°„

```python
accounts = await client.get_account_list()
# è¿”å›è´¦æˆ·åˆ—è¡¨ï¼ŒåŒæ—¶ç¼“å­˜å¸‚åœºç±»å‹ä¸è´¦æˆ·IDçš„æ˜ å°„
```

#### 3. `place_order(trade_request)`
è‡ªåŠ¨åŒ¹é…è´¦æˆ·å¹¶ä¸‹å•

```python
# ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
# 1. æ ¹æ®market_type="HK"è·å–æ¸¯è‚¡è´¦æˆ·ID
# 2. ä½¿ç”¨è¯¥è´¦æˆ·IDæäº¤è®¢å•
response = await client.place_order(trade_request)
```

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### Pythonç¤ºä¾‹

```python
import requests

BASE_URL = "http://localhost:8000"

# 1. æŸ¥çœ‹æ‰€æœ‰è´¦æˆ·
response = requests.get(f"{BASE_URL}/api/accounts")
accounts = response.json()
print("æˆ‘çš„è´¦æˆ·:")
for acc in accounts:
    print(f"  {acc['market_type']}: {acc['account_name']} (ID: {acc['account_id']})")

# 2. æŸ¥è¯¢æ¸¯è‚¡è´¦æˆ·ä¿¡æ¯ï¼ˆè‡ªåŠ¨åŒ¹é…ï¼‰
response = requests.get(f"{BASE_URL}/api/account/info?market_type=HK")
hk_account = response.json()
print(f"\næ¸¯è‚¡è´¦æˆ·èµ„äº§: ${hk_account['net_asset']}")

# 3. ä¹°å…¥æ¸¯è‚¡ï¼ˆè‡ªåŠ¨ä½¿ç”¨æ¸¯è‚¡è´¦æˆ·ï¼‰
response = requests.post(
    f"{BASE_URL}/api/trade/buy",
    params={
        "stock_code": "00700",
        "market_type": "HK",
        "quantity": 100,
        "price": 380.00,
        "order_type": "LIMIT"
    }
)
result = response.json()
print(f"\nä¸‹å•ç»“æœ: {result['message']}")
print(f"ä½¿ç”¨è´¦æˆ·: {result['data']['account_id']}")

# 4. ä¹°å…¥ç¾è‚¡ï¼ˆè‡ªåŠ¨ä½¿ç”¨ç¾è‚¡è´¦æˆ·ï¼‰
response = requests.post(
    f"{BASE_URL}/api/trade/buy",
    params={
        "stock_code": "NVDA",
        "market_type": "US",
        "quantity": 10,
        "price": 202.50,
        "order_type": "LIMIT"
    }
)
result = response.json()
print(f"\nä¸‹å•ç»“æœ: {result['message']}")
print(f"ä½¿ç”¨è´¦æˆ·: {result['data']['account_id']}")

# 5. æŸ¥çœ‹æ¸¯è‚¡æŒä»“ï¼ˆè‡ªåŠ¨åŒ¹é…ï¼‰
response = requests.get(f"{BASE_URL}/api/positions?market_type=HK")
positions = response.json()
print(f"\næ¸¯è‚¡æŒä»“:")
for pos in positions:
    print(f"  {pos['stock_code']}: {pos['quantity']}è‚¡")

# 6. æŸ¥çœ‹ç¾è‚¡æŒä»“ï¼ˆè‡ªåŠ¨åŒ¹é…ï¼‰
response = requests.get(f"{BASE_URL}/api/positions?market_type=US")
positions = response.json()
print(f"\nç¾è‚¡æŒä»“:")
for pos in positions:
    print(f"  {pos['stock_code']}: {pos['quantity']}è‚¡")
```

### cURLç¤ºä¾‹

```bash
# æŸ¥çœ‹æ‰€æœ‰è´¦æˆ·
curl http://localhost:8000/api/accounts

# æŸ¥è¯¢æ¸¯è‚¡è´¦æˆ·ä¿¡æ¯
curl "http://localhost:8000/api/account/info?market_type=HK"

# ä¹°å…¥æ¸¯è‚¡è…¾è®¯
curl -X POST "http://localhost:8000/api/trade/buy?stock_code=00700&market_type=HK&quantity=100&price=380.00&order_type=LIMIT"

# ä¹°å…¥ç¾è‚¡è‹±ä¼Ÿè¾¾
curl -X POST "http://localhost:8000/api/trade/buy?stock_code=NVDA&market_type=US&quantity=10&price=202.50&order_type=LIMIT"

# ä¹°å…¥Aè‚¡èŒ…å°
curl -X POST "http://localhost:8000/api/trade/buy?stock_code=600519&market_type=CN&quantity=100&price=1650.00&order_type=LIMIT"

# æŸ¥çœ‹æ¸¯è‚¡æŒä»“
curl "http://localhost:8000/api/positions?market_type=HK"

# æŸ¥çœ‹ç¾è‚¡æŒä»“
curl "http://localhost:8000/api/positions?market_type=US"
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. è´¦æˆ·å¼€é€š
ç¡®ä¿åœ¨å¯Œé€”ç‰›ç‰›ä¸­å·²å¼€é€šå¯¹åº”å¸‚åœºçš„æ¨¡æ‹Ÿäº¤æ˜“è´¦æˆ·ï¼š
- å¦‚æœåªå¼€é€šäº†ç¾è‚¡è´¦æˆ·ï¼Œäº¤æ˜“æ¸¯è‚¡ä¼šæç¤º"æœªæ‰¾åˆ°HKå¸‚åœºçš„æ¨¡æ‹Ÿè´¦æˆ·"
- éœ€è¦åœ¨å¯Œé€”ç‰›ç‰›APPæˆ–ç½‘é¡µç‰ˆä¸­å¼€é€šå¯¹åº”å¸‚åœºçš„æ¨¡æ‹Ÿäº¤æ˜“

### 2. è´¦æˆ·ç¼“å­˜
- ç³»ç»Ÿä¼šç¼“å­˜è´¦æˆ·æ˜ å°„å…³ç³»ï¼Œæé«˜æ€§èƒ½
- å¦‚æœæ–°å¼€é€šäº†è´¦æˆ·ï¼Œé‡å¯æœåŠ¡å³å¯åˆ·æ–°

### 3. å…¼å®¹æ€§
- æ—§çš„APIè°ƒç”¨æ–¹å¼ä»ç„¶æ”¯æŒï¼ˆç›´æ¥æŒ‡å®šaccount_idï¼‰
- æ–°çš„æ–¹å¼æ›´æ™ºèƒ½ï¼Œæ¨èä½¿ç”¨market_typeå‚æ•°

### 4. é”™è¯¯å¤„ç†
å¦‚æœæœªæ‰¾åˆ°å¯¹åº”å¸‚åœºçš„è´¦æˆ·ï¼Œä¼šè¿”å›å‹å¥½çš„é”™è¯¯æç¤ºï¼š
```json
{
    "success": false,
    "message": "æœªæ‰¾åˆ°HKå¸‚åœºçš„æ¨¡æ‹Ÿè´¦æˆ·ï¼Œè¯·å…ˆåœ¨å¯Œé€”ç‰›ç‰›ä¸­å¼€é€šè¯¥å¸‚åœºçš„æ¨¡æ‹Ÿäº¤æ˜“è´¦æˆ·"
}
```

## ğŸ¯ ä¼˜åŠ¿

1. **è‡ªåŠ¨åŒ–**: æ— éœ€æ‰‹åŠ¨ç®¡ç†è´¦æˆ·ID
2. **æ™ºèƒ½åŒ–**: æ ¹æ®è‚¡ç¥¨ä»£ç è‡ªåŠ¨é€‰æ‹©è´¦æˆ·
3. **ç®€å•åŒ–**: APIè°ƒç”¨æ›´ç®€æ´
4. **å®‰å…¨æ€§**: é¿å…è´¦æˆ·IDæ··æ·†å¯¼è‡´çš„é”™è¯¯
5. **çµæ´»æ€§**: æ”¯æŒå¤šç§æŸ¥è¯¢æ–¹å¼

## ğŸ“ æ›´æ–°æ–‡ä»¶

- `futu_client.py`: æ·»åŠ è´¦æˆ·è‡ªåŠ¨åŒ¹é…é€»è¾‘
- `main.py`: æ›´æ–°APIæ¥å£ï¼Œæ”¯æŒmarket_typeå‚æ•°
- `config.py`: æ·»åŠ ATTRIBUTE_MARKETæ˜ å°„
- `æ›´æ–°è¯´æ˜.md`: æœ¬æ–‡æ¡£

## ğŸš€ å‡çº§æ­¥éª¤

1. æ›´æ–°ä»£ç æ–‡ä»¶
2. é‡å¯æœåŠ¡
3. è®¿é—® `/api/accounts` æŸ¥çœ‹è´¦æˆ·æ˜ å°„
4. å¼€å§‹ä½¿ç”¨æ–°çš„APIæ–¹å¼

å°±è¿™ä¹ˆç®€å•ï¼ç°åœ¨ä½ å¯ä»¥æ›´è½»æ¾åœ°è¿›è¡Œå¤šå¸‚åœºäº¤æ˜“äº†ï¼ğŸ‰
