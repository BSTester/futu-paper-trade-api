# å¯Œé€”æ¨¡æ‹Ÿäº¤æ˜“ - ç¾è‚¡ä¸“ç”¨æ¥å£è¯´æ˜

## é‡è¦å‘ç° âš ï¸

ç¾è‚¡å¸‚åœºä½¿ç”¨**ä¸åŒçš„æ¥å£**ï¼Œä¸Aè‚¡/æ¸¯è‚¡ä¸åŒï¼

---

## ä¸€ã€ç¾è‚¡ä¹°å…¥æ¥å£

### æ¥å£ä¿¡æ¯
- **æ¥å£åç§°**: `inputIntegratedOrder`
- **è¯·æ±‚æ–¹å¼**: POST
- **æ¥å£åœ°å€**: `https://www.futunn.com/paper-trade/common-api?_m=inputIntegratedOrder`

### è¯·æ±‚å‚æ•°

```
account_id=16992013
market_type=100
price=202.49
side=B                    # B = ä¹°å…¥ (Buy)
quantity=1
order_type=1
security_id=202597
period_type=2             # æ–°å‚æ•°ï¼šäº¤æ˜“æ—¶æ®µç±»å‹
```

### å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| account_id | string | æ˜¯ | è´¦æˆ·ID |
| market_type | number | æ˜¯ | å¸‚åœºç±»å‹ (100=ç¾è‚¡) |
| price | string | æ˜¯ | ä¹°å…¥ä»·æ ¼ |
| side | string | æ˜¯ | **B** = ä¹°å…¥ |
| quantity | number | æ˜¯ | ä¹°å…¥æ•°é‡ |
| order_type | number | æ˜¯ | 1 = é™ä»·å• |
| security_id | string | æ˜¯ | è¯åˆ¸ID |
| period_type | number | æ˜¯ | äº¤æ˜“æ—¶æ®µç±»å‹ (2=æ­£å¸¸äº¤æ˜“æ—¶æ®µ) |

### period_type è¯´æ˜

| å€¼ | è¯´æ˜ |
|----|------|
| 1 | ç›˜å‰äº¤æ˜“ (Pre-market) |
| 2 | æ­£å¸¸äº¤æ˜“æ—¶æ®µ (Regular) |
| 3 | ç›˜åäº¤æ˜“ (After-hours) |

---

## äºŒã€ç¾è‚¡å–å‡ºæ¥å£

### æ¥å£ä¿¡æ¯
- **æ¥å£åç§°**: `inputIntegratedOrder`
- **è¯·æ±‚æ–¹å¼**: POST
- **æ¥å£åœ°å€**: `https://www.futunn.com/paper-trade/common-api?_m=inputIntegratedOrder`

### è¯·æ±‚å‚æ•°

```
account_id=16992013
market_type=100
price=202.49
side=A                    # A = å–å‡º (Ask/Sell) âš ï¸ æ³¨æ„ä¸æ˜¯Sï¼
quantity=1
order_type=1
security_id=202597
period_type=2
```

### å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| account_id | string | æ˜¯ | è´¦æˆ·ID |
| market_type | number | æ˜¯ | å¸‚åœºç±»å‹ (100=ç¾è‚¡) |
| price | string | æ˜¯ | å–å‡ºä»·æ ¼ |
| side | string | æ˜¯ | **A** = å–å‡º (Ask) âš ï¸ |
| quantity | number | æ˜¯ | å–å‡ºæ•°é‡ |
| order_type | number | æ˜¯ | 1 = é™ä»·å• |
| security_id | string | æ˜¯ | è¯åˆ¸ID |
| period_type | number | æ˜¯ | äº¤æ˜“æ—¶æ®µç±»å‹ |

### âš ï¸ é‡è¦æç¤º
ç¾è‚¡å–å‡ºä½¿ç”¨ `side=A` è€Œä¸æ˜¯ `side=S`ï¼

---

## ä¸‰ã€ç¾è‚¡æ’¤å•æ¥å£

### æ¥å£ä¿¡æ¯
- **æ¥å£åç§°**: `cancelIntegratedOrder`
- **è¯·æ±‚æ–¹å¼**: POST
- **æ¥å£åœ°å€**: `https://www.futunn.com/paper-trade/common-api?_m=cancelIntegratedOrder`

### è¯·æ±‚å‚æ•°

```
account_id=16992013
market_type=100
order_id=6363648
```

### å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| account_id | string | æ˜¯ | è´¦æˆ·ID |
| market_type | number | æ˜¯ | å¸‚åœºç±»å‹ (100=ç¾è‚¡) |
| order_id | string | æ˜¯ | è®¢å•ID |

---

## å››ã€æ¥å£å¯¹æ¯”

### Aè‚¡/æ¸¯è‚¡ vs ç¾è‚¡

| åŠŸèƒ½ | Aè‚¡/æ¸¯è‚¡æ¥å£ | ç¾è‚¡æ¥å£ |
|------|-------------|----------|
| ä¸‹å• | `inputOrder` | `inputIntegratedOrder` |
| æ’¤å• | `cancelOrder` | `cancelIntegratedOrder` |
| ä¹°å…¥å‚æ•° | `side=B` | `side=B` |
| å–å‡ºå‚æ•° | `side=S` | `side=A` âš ï¸ |
| ç‰¹æ®Šå‚æ•° | æ—  | `period_type` |

---

## äº”ã€Pythonå®ç°

### æ›´æ–°åçš„ä¸‹å•æ–¹æ³•

```python
async def place_order(self, trade_request: TradeRequest) -> TradeResponse:
    """ä¸‹å•äº¤æ˜“ï¼ˆæ”¯æŒæ‰€æœ‰å¸‚åœºï¼‰"""
    
    market_type = trade_request.market_type
    account_id = self.get_account_id_by_market(market_type)
    
    # æœç´¢è‚¡ç¥¨è·å–security_id
    stocks = await self.search_stock(trade_request.stock_code, market_type)
    security_id = stocks[0].security_id
    
    # æ ¹æ®å¸‚åœºç±»å‹é€‰æ‹©æ¥å£
    if market_type == "US":
        # ç¾è‚¡ä½¿ç”¨ inputIntegratedOrder
        url = f"{FUTU_BASE_URL}/paper-trade/common-api"
        params = {"_m": "inputIntegratedOrder"}
        
        # ç¾è‚¡å–å‡ºä½¿ç”¨ side=A
        side = "B" if trade_request.side == "BUY" else "A"
        
        order_data = {
            "account_id": str(account_id),
            "market_type": 100,
            "price": str(trade_request.price),
            "side": side,
            "quantity": trade_request.quantity,
            "order_type": 1,
            "security_id": str(security_id),
            "period_type": 2  # æ­£å¸¸äº¤æ˜“æ—¶æ®µ
        }
    else:
        # Aè‚¡/æ¸¯è‚¡ä½¿ç”¨ inputOrder
        url = f"{FUTU_BASE_URL}/paper-trade/common-api"
        params = {"_m": "inputOrder"}
        
        side = "B" if trade_request.side == "BUY" else "S"
        market_type_code = MARKET_TYPE.get(market_type, 3)
        
        order_data = {
            "account_id": str(account_id),
            "security_id": str(security_id),
            "market_type": market_type_code,
            "side": side,
            "order_type": 1,
            "price": str(trade_request.price),
            "quantity": trade_request.quantity,
            "security_type": 1
        }
    
    # æäº¤è®¢å•
    data = await self._request("POST", url, params=params, json=order_data)
    return TradeResponse(...)
```

### æ›´æ–°åçš„æ’¤å•æ–¹æ³•

```python
async def cancel_order(self, order_id: str, account_id: str, market_type: str) -> TradeResponse:
    """æ’¤é”€è®¢å•ï¼ˆæ”¯æŒæ‰€æœ‰å¸‚åœºï¼‰"""
    
    # æ ¹æ®å¸‚åœºç±»å‹é€‰æ‹©æ¥å£
    if market_type == "US":
        # ç¾è‚¡ä½¿ç”¨ cancelIntegratedOrder
        url = f"{FUTU_BASE_URL}/paper-trade/common-api"
        params = {"_m": "cancelIntegratedOrder"}
        
        cancel_data = {
            "account_id": str(account_id),
            "market_type": 100,
            "order_id": str(order_id)
        }
    else:
        # Aè‚¡/æ¸¯è‚¡ä½¿ç”¨ cancelOrder
        url = f"{FUTU_BASE_URL}/paper-trade/common-api"
        params = {"_m": "cancelOrder"}
        
        cancel_data = {
            "account_id": str(account_id),
            "order_id": str(order_id)
        }
    
    # æäº¤æ’¤å•è¯·æ±‚
    data = await self._request("POST", url, params=params, json=cancel_data)
    return TradeResponse(...)
```

---

## å…­ã€ä½¿ç”¨ç¤ºä¾‹

### ç¾è‚¡ä¹°å…¥

```python
from futu_client import FutuClient
from models import TradeRequest

client = FutuClient()

# ä¹°å…¥è‹¹æœè‚¡ç¥¨
trade_request = TradeRequest(
    stock_code="AAPL",
    market_type="US",
    side="BUY",
    order_type="LIMIT",
    price=180.0,
    quantity=10,
    security_type="STOCK"
)

result = await client.place_order(trade_request)
```

### ç¾è‚¡å–å‡º

```python
# å–å‡ºè‹¹æœè‚¡ç¥¨
trade_request = TradeRequest(
    stock_code="AAPL",
    market_type="US",
    side="SELL",  # å†…éƒ¨ä¼šè½¬æ¢ä¸º side=A
    order_type="LIMIT",
    price=185.0,
    quantity=10,
    security_type="STOCK"
)

result = await client.place_order(trade_request)
```

### ç¾è‚¡æ’¤å•

```python
# æ’¤é”€ç¾è‚¡è®¢å•
result = await client.cancel_order(
    order_id="6363648",
    account_id="16992013",
    market_type="US"
)
```

---

## ä¸ƒã€æ³¨æ„äº‹é¡¹

### 1. æ¥å£å·®å¼‚
- **ç¾è‚¡**: ä½¿ç”¨ `inputIntegratedOrder` å’Œ `cancelIntegratedOrder`
- **Aè‚¡/æ¸¯è‚¡**: ä½¿ç”¨ `inputOrder` å’Œ `cancelOrder`

### 2. å‚æ•°å·®å¼‚
- **ç¾è‚¡å–å‡º**: `side=A` (Ask)
- **Aè‚¡/æ¸¯è‚¡å–å‡º**: `side=S` (Sell)

### 3. ç‰¹æ®Šå‚æ•°
- **ç¾è‚¡**: éœ€è¦ `period_type` å‚æ•°
- **Aè‚¡/æ¸¯è‚¡**: éœ€è¦ `security_type` å‚æ•°

### 4. äº¤æ˜“æ—¶æ®µ
ç¾è‚¡æ”¯æŒä¸‰ä¸ªäº¤æ˜“æ—¶æ®µï¼š
- ç›˜å‰äº¤æ˜“ (4:00-9:30 ET)
- æ­£å¸¸äº¤æ˜“ (9:30-16:00 ET)
- ç›˜åäº¤æ˜“ (16:00-20:00 ET)

---

## å…«ã€æµ‹è¯•å»ºè®®

### æµ‹è¯•æµç¨‹

1. **æµ‹è¯•ç¾è‚¡ä¹°å…¥**:
   ```python
   # ä½¿ç”¨ inputIntegratedOrder, side=B
   result = place_order(market_type="US", side="BUY")
   ```

2. **æµ‹è¯•ç¾è‚¡å–å‡º**:
   ```python
   # ä½¿ç”¨ inputIntegratedOrder, side=A
   result = place_order(market_type="US", side="SELL")
   ```

3. **æµ‹è¯•ç¾è‚¡æ’¤å•**:
   ```python
   # ä½¿ç”¨ cancelIntegratedOrder
   result = cancel_order(market_type="US", order_id="...")
   ```

4. **å¯¹æ¯”Aè‚¡/æ¸¯è‚¡**:
   ```python
   # ç¡®ä¿Aè‚¡/æ¸¯è‚¡ä»ä½¿ç”¨åŸæ¥å£
   result = place_order(market_type="CN", side="BUY")
   ```

---

## ä¹ã€æ›´æ–°æ¸…å•

éœ€è¦æ›´æ–°çš„æ–‡ä»¶ï¼š
- [ ] `futu_client.py` - æ›´æ–°ä¸‹å•å’Œæ’¤å•æ–¹æ³•
- [ ] `config.py` - æ·»åŠ ç¾è‚¡ä¸“ç”¨é…ç½®
- [ ] `APIæ¥å£æ–‡æ¡£.md` - æ·»åŠ ç¾è‚¡æ¥å£è¯´æ˜
- [ ] `test_sell_and_cancel.py` - æ·»åŠ ç¾è‚¡æµ‹è¯•

---

## åã€æ€»ç»“

âœ… **å‘ç°çš„å…³é”®ä¿¡æ¯**:
1. ç¾è‚¡ä½¿ç”¨ç‹¬ç«‹çš„æ¥å£ç³»ç»Ÿ
2. ç¾è‚¡å–å‡ºä½¿ç”¨ `side=A` è€Œä¸æ˜¯ `side=S`
3. ç¾è‚¡éœ€è¦ `period_type` å‚æ•°
4. ç¾è‚¡æ’¤å•éœ€è¦ `market_type` å‚æ•°

âš ï¸ **éœ€è¦æ³¨æ„**:
- ä¸åŒå¸‚åœºä½¿ç”¨ä¸åŒçš„æ¥å£
- å‚æ•°æ ¼å¼æœ‰å·®å¼‚
- éœ€è¦åˆ†åˆ«å¤„ç†

ğŸ¯ **ä¸‹ä¸€æ­¥**:
æ›´æ–°Pythonå®¢æˆ·ç«¯ä»¥æ”¯æŒç¾è‚¡ä¸“ç”¨æ¥å£
