# æ’¤å•åŠŸèƒ½å®Œæˆè¯´æ˜

## âœ… å·²æ·»åŠ çš„æ¥å£

### 1. æ’¤å•æ¥å£ï¼ˆPOSTæ–¹å¼ï¼‰

**ç«¯ç‚¹**: `POST /api/trade/cancel`

**å‚æ•°**:
- `order_id` (å¿…å¡«): è®¢å•ID
- `account_id` (å¯é€‰): è´¦æˆ·ID
- `market_type` (å¯é€‰): å¸‚åœºç±»å‹ (US/HK/CN)

**æ³¨æ„**: `account_id` å’Œ `market_type` è‡³å°‘æä¾›ä¸€ä¸ª

**ç¤ºä¾‹1 - ä½¿ç”¨è´¦æˆ·ID**:
```bash
curl -X POST "http://localhost:8000/api/trade/cancel" \
  -H "Content-Type: application/json" \
  -d '{
    "order_id": "123456789",
    "account_id": "9393"
  }'
```

**ç¤ºä¾‹2 - ä½¿ç”¨å¸‚åœºç±»å‹**:
```bash
curl -X POST "http://localhost:8000/api/trade/cancel" \
  -H "Content-Type: application/json" \
  -d '{
    "order_id": "123456789",
    "market_type": "US"
  }'
```

**å“åº”æ ¼å¼**:
```json
{
  "success": true,
  "message": "æ’¤å•æˆåŠŸ",
  "order_id": "123456789",
  "data": {
    "account_id": "16992013",
    "order_id": "123456789",
    "market_type": "US"
  }
}
```

### 2. æ’¤å•æ¥å£ï¼ˆRESTfulé£æ ¼ï¼‰

**ç«¯ç‚¹**: `DELETE /api/trade/order/{order_id}`

**å‚æ•°**:
- `order_id` (è·¯å¾„å‚æ•°): è®¢å•ID
- `market_type` (æŸ¥è¯¢å‚æ•°): å¸‚åœºç±»å‹ (US/HK/CN)

**ç¤ºä¾‹**:
```bash
curl -X DELETE "http://localhost:8000/api/trade/order/123456789?market_type=US"
```

**å“åº”æ ¼å¼**:
```json
{
  "success": true,
  "message": "æ’¤å•æˆåŠŸ",
  "order_id": "123456789",
  "data": {
    "account_id": "16992013",
    "order_id": "123456789",
    "market_type": "US"
  }
}
```

### 3. è®¢å•å†å²æŸ¥è¯¢æ¥å£

**ç«¯ç‚¹**: `GET /api/orders`

**å‚æ•°**:
- `account_id` (å¯é€‰): è´¦æˆ·ID
- `market_type` (å¯é€‰): å¸‚åœºç±»å‹ (US/HK/CN)
- `filter_status` (å¯é€‰): è¿‡æ»¤çŠ¶æ€
  - 0: å…¨éƒ¨è®¢å•ï¼ˆé»˜è®¤ï¼‰
  - 1: å·²æˆäº¤
  - 2: ç­‰å¾…æˆäº¤
  - 3: å·²æ’¤å•
- `side` (å¯é€‰): äº¤æ˜“æ–¹å‘
  - ç©ºå­—ç¬¦ä¸²: å…¨éƒ¨ï¼ˆé»˜è®¤ï¼‰
  - B: ä¹°å…¥
  - S: å–å‡º
- `start_time` (å¯é€‰): å¼€å§‹æ—¶é—´ï¼ˆUnixæ—¶é—´æˆ³ï¼Œé»˜è®¤å½“å¤©0ç‚¹ï¼‰
- `end_time` (å¯é€‰): ç»“æŸæ—¶é—´ï¼ˆUnixæ—¶é—´æˆ³ï¼Œé»˜è®¤å½“å¤©24ç‚¹ï¼‰

**ç¤ºä¾‹1 - æŸ¥è¯¢ç¾è‚¡æ‰€æœ‰è®¢å•**:
```bash
curl "http://localhost:8000/api/orders?market_type=US"
```

**ç¤ºä¾‹2 - æŸ¥è¯¢æ¸¯è‚¡å·²æˆäº¤è®¢å•**:
```bash
curl "http://localhost:8000/api/orders?market_type=HK&filter_status=1"
```

**ç¤ºä¾‹3 - æŸ¥è¯¢ç¾è‚¡ä¹°å…¥è®¢å•**:
```bash
curl "http://localhost:8000/api/orders?market_type=US&side=B"
```

**ç¤ºä¾‹4 - æŸ¥è¯¢æŒ‡å®šæ—¶é—´èŒƒå›´çš„è®¢å•**:
```bash
curl "http://localhost:8000/api/orders?market_type=US&start_time=1730419200&end_time=1730505599"
```

**å“åº”æ ¼å¼**:
```json
{
  "order_list": [
    {
      "order_id": "123456789",
      "stock_code": "AAPL",
      "stock_name": "è‹¹æœ",
      "side": "B",
      "order_type": "LIMIT",
      "price": 180.50,
      "quantity": 10,
      "filled_quantity": 10,
      "status": "å·²æˆäº¤",
      "create_time": 1730419200,
      "update_time": 1730419300
    }
  ],
  "total": 1
}
```

## ğŸ“‹ å®Œæ•´çš„äº¤æ˜“æ¥å£åˆ—è¡¨

### ä¸‹å•æ¥å£

1. **é€šç”¨ä¸‹å•**: `POST /api/trade`
   - æ”¯æŒæ‰€æœ‰å¸‚åœºå’Œè®¢å•ç±»å‹
   - å®Œæ•´çš„å‚æ•°æ§åˆ¶

2. **å¿«é€Ÿä¹°å…¥**: `POST /api/trade/buy`
   - ç®€åŒ–çš„ä¹°å…¥æ¥å£
   - å‚æ•°æ›´ç®€æ´

3. **å¿«é€Ÿå–å‡º**: `POST /api/trade/sell`
   - ç®€åŒ–çš„å–å‡ºæ¥å£
   - å‚æ•°æ›´ç®€æ´

### æ’¤å•æ¥å£

4. **æ’¤å•ï¼ˆPOSTï¼‰**: `POST /api/trade/cancel`
   - æ”¯æŒé€šè¿‡è´¦æˆ·IDæˆ–å¸‚åœºç±»å‹æ’¤å•
   - çµæ´»çš„å‚æ•°ç»„åˆ

5. **æ’¤å•ï¼ˆDELETEï¼‰**: `DELETE /api/trade/order/{order_id}`
   - RESTfulé£æ ¼
   - è·¯å¾„å‚æ•° + æŸ¥è¯¢å‚æ•°

### æŸ¥è¯¢æ¥å£

6. **è®¢å•å†å²**: `GET /api/orders`
   - æ”¯æŒå¤šç§è¿‡æ»¤æ¡ä»¶
   - æ”¯æŒæ—¶é—´èŒƒå›´æŸ¥è¯¢
   - æ”¯æŒçŠ¶æ€å’Œæ–¹å‘è¿‡æ»¤

## ğŸ”§ åº•å±‚å®ç°

### FutuClient ä¸­çš„æ–¹æ³•

1. **cancel_order** - æ’¤å•æ–¹æ³•
   ```python
   async def cancel_order(
       self, 
       order_id: str, 
       account_id: str = None, 
       market_type: str = None
   ) -> TradeResponse
   ```
   
   - æ”¯æŒç¾è‚¡ã€æ¸¯è‚¡ã€Aè‚¡
   - è‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„APIæ¥å£
   - ç¾è‚¡ä½¿ç”¨ `cancelIntegratedOrder`
   - æ¸¯è‚¡/Aè‚¡ä½¿ç”¨ `cancelOrder`

2. **get_order_history** - è®¢å•å†å²æŸ¥è¯¢
   ```python
   async def get_order_history(
       self, 
       account_id: str = None, 
       market_type: str = None,
       filter_status: int = 0,
       side: str = "",
       start_time: int = None,
       end_time: int = None
   ) -> Dict[str, Any]
   ```
   
   - æ”¯æŒå¤šç§è¿‡æ»¤æ¡ä»¶
   - è‡ªåŠ¨å¤„ç†æ—¶é—´èŒƒå›´
   - é»˜è®¤æŸ¥è¯¢å½“å¤©è®¢å•

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´çš„äº¤æ˜“æµç¨‹

```python
import httpx
import asyncio

async def trading_workflow():
    base_url = "http://localhost:8000"
    
    # 1. ä¹°å…¥è‚¡ç¥¨
    buy_response = await httpx.AsyncClient().post(
        f"{base_url}/api/trade/buy",
        params={
            "stock_code": "AAPL",
            "market_type": "US",
            "quantity": 10,
            "price": 180.50,
            "order_type": "LIMIT"
        }
    )
    buy_data = buy_response.json()
    order_id = buy_data["order_id"]
    print(f"ä¸‹å•æˆåŠŸï¼Œè®¢å•ID: {order_id}")
    
    # 2. æŸ¥è¯¢è®¢å•çŠ¶æ€
    orders_response = await httpx.AsyncClient().get(
        f"{base_url}/api/orders",
        params={"market_type": "US"}
    )
    orders = orders_response.json()
    print(f"å½“å‰è®¢å•: {orders}")
    
    # 3. æ’¤é”€è®¢å•ï¼ˆå¦‚æœéœ€è¦ï¼‰
    cancel_response = await httpx.AsyncClient().post(
        f"{base_url}/api/trade/cancel",
        json={
            "order_id": order_id,
            "market_type": "US"
        }
    )
    cancel_data = cancel_response.json()
    print(f"æ’¤å•ç»“æœ: {cancel_data}")

# è¿è¡Œ
asyncio.run(trading_workflow())
```

### åœ¨ Swagger UI ä¸­æµ‹è¯•

1. è®¿é—® http://localhost:8000/docs
2. æ‰¾åˆ° "äº¤æ˜“" æ ‡ç­¾ä¸‹çš„æ¥å£
3. ç‚¹å‡»æ¥å£å±•å¼€
4. ç‚¹å‡» "Try it out"
5. å¡«å†™å‚æ•°
6. ç‚¹å‡» "Execute"
7. æŸ¥çœ‹å“åº”ç»“æœ

## ğŸ¯ æ¥å£ç‰¹ç‚¹

### 1. çµæ´»çš„å‚æ•°ç»„åˆ

- å¯ä»¥ä½¿ç”¨ `account_id` ç›´æ¥æŒ‡å®šè´¦æˆ·
- å¯ä»¥ä½¿ç”¨ `market_type` è‡ªåŠ¨åŒ¹é…è´¦æˆ·
- ç³»ç»Ÿä¼šæ ¹æ®é…ç½®è‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„è´¦æˆ·

### 2. å¤šå¸‚åœºæ”¯æŒ

- ç¾è‚¡ (US)
- æ¸¯è‚¡ (HK)
- Aè‚¡ (CN)

### 3. è‡ªåŠ¨æ¥å£é€‰æ‹©

- ç¾è‚¡ä½¿ç”¨ `cancelIntegratedOrder` æ¥å£
- æ¸¯è‚¡/Aè‚¡ä½¿ç”¨ `cancelOrder` æ¥å£
- ç”¨æˆ·æ— éœ€å…³å¿ƒåº•å±‚å·®å¼‚

### 4. å®Œå–„çš„é”™è¯¯å¤„ç†

- å‚æ•°éªŒè¯
- è´¦æˆ·æ£€æŸ¥
- è®¢å•çŠ¶æ€æ£€æŸ¥
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

## ğŸ“Š API ç«¯ç‚¹æ€»è§ˆ

| æ–¹æ³• | ç«¯ç‚¹ | åŠŸèƒ½ | æ ‡ç­¾ |
|------|------|------|------|
| POST | /api/trade | é€šç”¨ä¸‹å• | äº¤æ˜“ |
| POST | /api/trade/buy | å¿«é€Ÿä¹°å…¥ | äº¤æ˜“ |
| POST | /api/trade/sell | å¿«é€Ÿå–å‡º | äº¤æ˜“ |
| POST | /api/trade/cancel | æ’¤å• | äº¤æ˜“ |
| DELETE | /api/trade/order/{order_id} | æ’¤å•ï¼ˆRESTfulï¼‰ | äº¤æ˜“ |
| GET | /api/orders | è®¢å•å†å² | äº¤æ˜“ |
| GET | /api/accounts | è´¦æˆ·åˆ—è¡¨ | è´¦æˆ· |
| GET | /api/account/info | è´¦æˆ·ä¿¡æ¯ | è´¦æˆ· |
| GET | /api/positions | æŒä»“åˆ—è¡¨ | æŒä»“ |
| POST | /api/stock/search | è‚¡ç¥¨æœç´¢ | è¡Œæƒ… |
| GET | /api/stock/quote | è‚¡ç¥¨è¡Œæƒ… | è¡Œæƒ… |
| GET | /api/stock/hot | çƒ­é—¨è‚¡ç¥¨ | è¡Œæƒ… |

## âœ… æµ‹è¯•çŠ¶æ€

### æ¥å£å®šä¹‰ âœ…
- æ‰€æœ‰æ¥å£å·²åœ¨ main.py ä¸­å®šä¹‰
- å‚æ•°éªŒè¯å®Œæ•´
- æ–‡æ¡£æ³¨é‡Šè¯¦ç»†

### åº•å±‚å®ç° âœ…
- FutuClient ä¸­çš„æ–¹æ³•å·²å®ç°
- æ”¯æŒå¤šå¸‚åœº
- é”™è¯¯å¤„ç†å®Œå–„

### æ–‡æ¡£ç”Ÿæˆ âœ…
- Swagger UI è‡ªåŠ¨ç”Ÿæˆ
- æ¥å£è¯´æ˜å®Œæ•´
- ç¤ºä¾‹ä»£ç æ¸…æ™°

### å¾…æµ‹è¯• âš ï¸
- éœ€è¦æœ‰æ•ˆçš„ Cookie æ‰èƒ½æµ‹è¯•å®é™…åŠŸèƒ½
- éœ€è¦çœŸå®çš„è®¢å•IDæ‰èƒ½æµ‹è¯•æ’¤å•
- å»ºè®®å…ˆæµ‹è¯•ä¸‹å•ï¼Œè·å–è®¢å•IDåå†æµ‹è¯•æ’¤å•

## ğŸš€ ä¸‹ä¸€æ­¥

1. **é…ç½® Cookie**: åœ¨ .env æ–‡ä»¶ä¸­é…ç½®æœ‰æ•ˆçš„ FUTU_COOKIE
2. **æµ‹è¯•ä¸‹å•**: ä½¿ç”¨ /api/trade/buy æ¥å£ä¸‹å•
3. **è·å–è®¢å•ID**: ä»ä¸‹å•å“åº”ä¸­è·å– order_id
4. **æµ‹è¯•æ’¤å•**: ä½¿ç”¨è·å–çš„ order_id æµ‹è¯•æ’¤å•æ¥å£
5. **æŸ¥è¯¢è®¢å•**: ä½¿ç”¨ /api/orders æ¥å£æŸ¥è¯¢è®¢å•å†å²

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **è®¢å•ID**: æ’¤å•éœ€è¦æœ‰æ•ˆçš„è®¢å•ID
2. **è®¢å•çŠ¶æ€**: åªæœ‰æœªæˆäº¤çš„è®¢å•æ‰èƒ½æ’¤å•
3. **å¸‚åœºç±»å‹**: ç¡®ä¿æä¾›æ­£ç¡®çš„å¸‚åœºç±»å‹
4. **è´¦æˆ·é…ç½®**: ç¡®ä¿åœ¨ .env ä¸­é…ç½®äº†å¯¹åº”å¸‚åœºçš„è´¦æˆ·ID
5. **Cookieæœ‰æ•ˆæ€§**: ç¡®ä¿ Cookie æœªè¿‡æœŸ

---

**æ›´æ–°æ—¶é—´**: 2025-11-01 21:45
**æœåŠ¡åœ°å€**: http://localhost:8000
**æ–‡æ¡£åœ°å€**: http://localhost:8000/docs
**çŠ¶æ€**: âœ… æ’¤å•åŠŸèƒ½å·²å®Œæˆ
