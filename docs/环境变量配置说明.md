# 环境变量配置说明

## 📋 配置方式

账户映射通过 `.env` 文件中的环境变量配置，**不通过API接口暴露**。

## 🔧 环境变量说明

### 基础配置

```env
# API服务配置
API_HOST=0.0.0.0
API_PORT=8000
```

### 账户配置

```env
# 港股账户ID
ACCOUNT_ID_HK=9393

# 美股模拟账户ID
ACCOUNT_ID_US=11587526

# A股账户ID（如果有）
ACCOUNT_ID_CN=

# 美股比赛账户ID（可选）
# 留空表示使用美股模拟账户，填入则使用比赛账户
ACCOUNT_ID_US_COMPETITION=

# 默认账户ID（当无法匹配市场时使用）
ACCOUNT_ID=11587526
```

## 🎯 匹配规则

系统根据股票代码的市场类型，自动使用对应的账户：

### 1. 港股 (HK)
- 使用 `ACCOUNT_ID_HK` 配置的账户
- 示例：00700 (腾讯) → 使用港股账户

### 2. 美股 (US)
- **如果配置了 `ACCOUNT_ID_US_COMPETITION`**：使用比赛账户
- **否则**：使用 `ACCOUNT_ID_US` 配置的模拟账户
- 示例：NVDA → 根据配置使用模拟账户或比赛账户

### 3. A股 (CN)
- 使用 `ACCOUNT_ID_CN` 配置的账户
- 示例：600519 (茅台) → 使用A股账户

### 4. 未匹配
- 使用 `ACCOUNT_ID` 配置的默认账户

## 📊 配置示例

### 场景1：使用模拟账户（默认）

```env
ACCOUNT_ID_HK=9393
ACCOUNT_ID_US=11587526
ACCOUNT_ID_CN=
ACCOUNT_ID_US_COMPETITION=
ACCOUNT_ID=11587526
```

**结果**：
- 港股 → 9393
- 美股 → 11587526 (模拟账户)
- A股 → 未配置

### 场景2：使用比赛账户

```env
ACCOUNT_ID_HK=9393
ACCOUNT_ID_US=11587526
ACCOUNT_ID_CN=
ACCOUNT_ID_US_COMPETITION=16992013
ACCOUNT_ID=11587526
```

**结果**：
- 港股 → 9393
- 美股 → 16992013 (比赛账户，优先于模拟账户)
- A股 → 未配置

### 场景3：配置所有市场

```env
ACCOUNT_ID_HK=9393
ACCOUNT_ID_US=11587526
ACCOUNT_ID_CN=12345
ACCOUNT_ID_US_COMPETITION=
ACCOUNT_ID=11587526
```

**结果**：
- 港股 → 9393
- 美股 → 11587526 (模拟账户)
- A股 → 12345

## 🚀 使用示例

### 买入股票

系统会根据股票代码自动匹配账户：

```bash
# 买入美股 NVDA
# 如果配置了 ACCOUNT_ID_US_COMPETITION，使用比赛账户
# 否则使用 ACCOUNT_ID_US 配置的模拟账户
curl -X POST "http://localhost:8000/api/trade/buy?stock_code=NVDA&market_type=US&quantity=10&price=202.50"

# 买入港股腾讯
# 使用 ACCOUNT_ID_HK 配置的账户
curl -X POST "http://localhost:8000/api/trade/buy?stock_code=00700&market_type=HK&quantity=100&price=380.00"

# 买入A股茅台
# 使用 ACCOUNT_ID_CN 配置的账户
curl -X POST "http://localhost:8000/api/trade/buy?stock_code=600519&market_type=CN&quantity=100&price=1650.00"
```

### 查询账户

```bash
# 查询美股账户
# 使用配置的美股账户（模拟或比赛）
curl "http://localhost:8000/api/account/info?market_type=US"

# 查询港股账户
curl "http://localhost:8000/api/account/info?market_type=HK"
```

## 🔄 切换账户

### 从模拟账户切换到比赛账户

编辑 `.env` 文件：

```env
# 添加比赛账户配置
ACCOUNT_ID_US_COMPETITION=16992013
```

重启服务：

```bash
python main.py
```

### 从比赛账户切换回模拟账户

编辑 `.env` 文件：

```env
# 清空比赛账户配置
ACCOUNT_ID_US_COMPETITION=
```

重启服务。

## 📝 启动日志

启动服务时会显示当前的账户映射：

```
📊 账户映射配置:
   HK -> 9393
   US -> 11587526
```

或者（如果配置了比赛账户）：

```
📊 账户映射配置:
   HK -> 9393
   US -> 16992013
```

## ⚠️ 注意事项

1. **配置优先级**
   - 美股比赛账户优先于模拟账户
   - 如果同时配置了两者，使用比赛账户

2. **配置生效**
   - 修改 `.env` 文件后需要重启服务
   - 启动时会读取并应用配置

3. **未配置市场**
   - 如果某个市场未配置账户，交易会失败
   - 建议至少配置常用市场的账户

4. **默认账户**
   - `ACCOUNT_ID` 用于无法匹配市场时的后备
   - 建议设置为最常用的账户

## 🔒 安全性

- 账户配置仅在 `.env` 文件中
- **不通过API接口暴露**
- 不会在日志中显示完整Cookie
- 建议将 `.env` 添加到 `.gitignore`

## 💡 最佳实践

1. **明确配置**
   - 明确配置每个市场的账户
   - 避免依赖默认账户

2. **文档化**
   - 在 `.env` 中添加注释
   - 说明每个账户的用途

3. **测试验证**
   - 修改配置后先测试
   - 确认使用了正确的账户

4. **备份配置**
   - 保存 `.env.example` 作为模板
   - 记录账户ID对应关系

## 📚 相关文件

- `.env` - 环境变量配置文件
- `.env.example` - 配置模板
- `config.py` - 配置读取逻辑
- `futu_client.py` - 账户匹配实现

## 🎉 总结

通过环境变量配置账户映射：
- ✅ 简单直接，易于理解
- ✅ 不暴露在API接口中
- ✅ 支持灵活切换账户
- ✅ 优先级清晰（比赛账户 > 模拟账户）
- ✅ 配置即生效（重启后）

现在你可以通过修改 `.env` 文件来控制使用哪个账户进行交易！🚀
