# å¯Œé€”æ¨¡æ‹Ÿäº¤æ˜“APIä½¿ç”¨ç¤ºä¾‹

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` åˆ° `.env` å¹¶å¡«å†™é…ç½®ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```env
# å¯Œé€”Cookieï¼ˆä»æµè§ˆå™¨è·å–ï¼‰
FUTU_COOKIE=your_cookie_here

# å„å¸‚åœºè´¦æˆ·ID
ACCOUNT_ID_US=16992013      # ç¾è‚¡æ¨¡æ‹Ÿè´¦æˆ·
ACCOUNT_ID_HK=9393          # æ¸¯è‚¡æ¨¡æ‹Ÿè´¦æˆ·
ACCOUNT_ID_CN=3182575       # Aè‚¡æ¨¡æ‹Ÿè´¦æˆ·
```

### 3. è·å–Cookie

1. æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® https://www.futunn.com/paper-trade
2. ç™»å½•ä½ çš„å¯Œé€”è´¦å·
3. æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·
4. åˆ‡æ¢åˆ° Network æ ‡ç­¾
5. åˆ·æ–°é¡µé¢
6. æ‰¾åˆ°ä»»æ„è¯·æ±‚ï¼Œå¤åˆ¶ Cookie å€¼
7. å°†Cookieç²˜è´´åˆ° `.env` æ–‡ä»¶ä¸­

## åŸºç¡€åŠŸèƒ½ç¤ºä¾‹

### 1. æŸ¥çœ‹è´¦æˆ·ä¿¡æ¯

```python
import asyncio
from futu_client import FutuClient

async def main():
    client = FutuClient()
    
    # æŸ¥çœ‹Aè‚¡è´¦æˆ·
    account = await client.get_account_info(market_type="CN")
    print(f"èµ„äº§å‡€å€¼: {account.net_asset}")
    print(f"å¯ç”¨èµ„é‡‘: {account.available_funds}")
    print(f"æŒä»“å¸‚å€¼: {account.market_value}")

asyncio.run(main())
```

### 2. æŸ¥çœ‹æŒä»“

```python
import asyncio
from futu_client import FutuClient

async def main():
    client = FutuClient()
    
    # æŸ¥çœ‹ç¾è‚¡æŒä»“
    positions = await client.get_positions(market_type="US")
    
    for pos in positions:
        print(f"{pos.stock_code} {pos.stock_name}")
        print(f"  æ•°é‡: {pos.quantity}")
        print(f"  æˆæœ¬: {pos.cost_price}")
        print(f"  ç°ä»·: {pos.current_price}")
        print(f"  ç›ˆäº: {pos.profit_loss} ({pos.profit_loss_ratio}%)")

asyncio.run(main())
```

### 3. æœç´¢è‚¡ç¥¨

```python
import asyncio
from futu_client import FutuClient

async def main():
    client = FutuClient()
    
    # æœç´¢è‹¹æœè‚¡ç¥¨
    stocks = await client.search_stock("AAPL", market_type="US")
    
    for stock in stocks:
        print(f"{stock.stock_code} - {stock.stock_name}")
        print(f"  è¯åˆ¸ID: {stock.security_id}")
        print(f"  å¸‚åœº: {stock.market_type}")

asyncio.run(main())
```

### 4. è·å–è‚¡ç¥¨è¡Œæƒ…

```python
import asyncio
from futu_client import FutuClient

async def main():
    client = FutuClient()
    
    # å…ˆæœç´¢è·å–security_id
    stocks = await client.search_stock("AAPL", market_type="US")
    security_id = stocks[0].security_id
    
    # è·å–è¡Œæƒ…
    quotes = await client.get_stock_quote([security_id], market_type="US")
    
    for quote in quotes:
        print(f"{quote.stock_code} {quote.stock_name}")
        print(f"  å½“å‰ä»·: {quote.current_price}")
        print(f"  æ¶¨è·Œ: {quote.change} ({quote.change_ratio}%)")
        print(f"  å¼€ç›˜: {quote.open_price}")
        print(f"  æœ€é«˜: {quote.high_price}")
        print(f"  æœ€ä½: {quote.low_price}")

asyncio.run(main())
```

### 5. ä¸‹å•äº¤æ˜“

```python
import asyncio
from futu_client import FutuClient
from models import TradeRequest

async def main():
    client = FutuClient()
    
    # ä¹°å…¥100è‚¡ä¸­å›½é“¶è¡Œ
    trade_request = TradeRequest(
        stock_code="601988",      # è‚¡ç¥¨ä»£ç 
        market_type="CN",         # å¸‚åœºç±»å‹: CN=Aè‚¡, HK=æ¸¯è‚¡, US=ç¾è‚¡
        side="BUY",               # äº¤æ˜“æ–¹å‘: BUY=ä¹°å…¥, SELL=å–å‡º
        order_type="LIMIT",       # è®¢å•ç±»å‹: LIMIT=é™ä»·å•, MARKET=å¸‚ä»·å•
        price=5.61,               # ä»·æ ¼
        quantity=100,             # æ•°é‡
        security_type="STOCK"     # è¯åˆ¸ç±»å‹: STOCK=è‚¡ç¥¨
    )
    
    result = await client.place_order(trade_request)
    
    if result.success:
        print(f"âœ… ä¸‹å•æˆåŠŸ")
        print(f"è®¢å•ID: {result.order_id}")
        print(f"è¯¦æƒ…: {result.data}")
    else:
        print(f"âŒ ä¸‹å•å¤±è´¥: {result.message}")

asyncio.run(main())
```

## å®Œæ•´äº¤æ˜“æµç¨‹ç¤ºä¾‹

```python
import asyncio
from futu_client import FutuClient
from models import TradeRequest

async def trade_workflow():
    """å®Œæ•´çš„äº¤æ˜“æµç¨‹"""
    client = FutuClient()
    
    # 1. æŸ¥çœ‹è´¦æˆ·ä¿¡æ¯
    print("1ï¸âƒ£ æŸ¥çœ‹è´¦æˆ·ä¿¡æ¯")
    account = await client.get_account_info(market_type="US")
    print(f"å¯ç”¨èµ„é‡‘: ${account.available_funds:,.2f}")
    
    # 2. æœç´¢è‚¡ç¥¨
    print("\n2ï¸âƒ£ æœç´¢è‚¡ç¥¨")
    keyword = "AAPL"
    stocks = await client.search_stock(keyword, market_type="US")
    if not stocks:
        print(f"æœªæ‰¾åˆ°è‚¡ç¥¨: {keyword}")
        return
    
    stock = stocks[0]
    print(f"æ‰¾åˆ°: {stock.stock_code} - {stock.stock_name}")
    
    # 3. è·å–å½“å‰ä»·æ ¼
    print("\n3ï¸âƒ£ è·å–å½“å‰ä»·æ ¼")
    quotes = await client.get_stock_quote([stock.security_id], market_type="US")
    if not quotes:
        print("æ— æ³•è·å–ä»·æ ¼")
        return
    
    current_price = quotes[0].current_price
    print(f"å½“å‰ä»·: ${current_price}")
    
    # 4. è®¡ç®—è´­ä¹°æ•°é‡
    print("\n4ï¸âƒ£ è®¡ç®—è´­ä¹°æ•°é‡")
    max_quantity = int(account.available_funds / current_price)
    buy_quantity = min(10, max_quantity)  # æœ€å¤šä¹°10è‚¡
    print(f"è®¡åˆ’ä¹°å…¥: {buy_quantity}è‚¡")
    
    # 5. ä¸‹å•
    print("\n5ï¸âƒ£ æäº¤è®¢å•")
    trade_request = TradeRequest(
        stock_code=stock.stock_code,
        market_type="US",
        side="BUY",
        order_type="LIMIT",
        price=current_price,
        quantity=buy_quantity,
        security_type="STOCK"
    )
    
    result = await client.place_order(trade_request)
    
    if result.success:
        print(f"âœ… è®¢å•å·²æäº¤")
        print(f"è®¢å•ID: {result.order_id}")
        print(f"è‚¡ç¥¨: {result.data['stock_name']}")
        print(f"ä»·æ ¼: ${result.data['price']}")
        print(f"æ•°é‡: {result.data['quantity']}")
        print(f"æ€»é¢: ${result.data['price'] * result.data['quantity']:,.2f}")
    else:
        print(f"âŒ ä¸‹å•å¤±è´¥: {result.message}")
    
    # 6. æŸ¥çœ‹æŒä»“
    print("\n6ï¸âƒ£ æŸ¥çœ‹æŒä»“")
    positions = await client.get_positions(market_type="US")
    for pos in positions:
        print(f"{pos.stock_code}: {pos.quantity}è‚¡, ç›ˆäº: ${pos.profit_loss:,.2f}")

asyncio.run(trade_workflow())
```

## å¤šå¸‚åœºäº¤æ˜“ç¤ºä¾‹

```python
import asyncio
from futu_client import FutuClient
from models import TradeRequest

async def multi_market_trading():
    """å¤šå¸‚åœºäº¤æ˜“ç¤ºä¾‹"""
    client = FutuClient()
    
    # å®šä¹‰äº¤æ˜“è®¡åˆ’
    trades = [
        {
            "name": "Aè‚¡-ä¸­å›½é“¶è¡Œ",
            "stock_code": "601988",
            "market_type": "CN",
            "price": 5.61,
            "quantity": 100
        },
        {
            "name": "æ¸¯è‚¡-è…¾è®¯æ§è‚¡",
            "stock_code": "00700",
            "market_type": "HK",
            "price": 400.0,
            "quantity": 100
        },
        {
            "name": "ç¾è‚¡-è‹¹æœ",
            "stock_code": "AAPL",
            "market_type": "US",
            "price": 180.0,
            "quantity": 10
        }
    ]
    
    # æ‰§è¡Œäº¤æ˜“
    for trade in trades:
        print(f"\nğŸ“ äº¤æ˜“: {trade['name']}")
        print("-" * 50)
        
        trade_request = TradeRequest(
            stock_code=trade["stock_code"],
            market_type=trade["market_type"],
            side="BUY",
            order_type="LIMIT",
            price=trade["price"],
            quantity=trade["quantity"],
            security_type="STOCK"
        )
        
        result = await client.place_order(trade_request)
        
        if result.success:
            print(f"âœ… æˆåŠŸ: {result.message}")
            if result.order_id:
                print(f"è®¢å•ID: {result.order_id}")
        else:
            print(f"âŒ å¤±è´¥: {result.message}")
        
        # é¿å…è¯·æ±‚è¿‡å¿«
        await asyncio.sleep(1)

asyncio.run(multi_market_trading())
```

## è¿è¡Œæµ‹è¯•

```bash
# æµ‹è¯•ä¸‹å•åŠŸèƒ½
python test_place_order.py

# æµ‹è¯•å®é™…äº¤æ˜“
python test_real_trade.py
```

## æ³¨æ„äº‹é¡¹

1. **Cookieæœ‰æ•ˆæœŸ**: Cookieä¼šè¿‡æœŸï¼Œéœ€è¦å®šæœŸæ›´æ–°
2. **å¸‚åœºæ—¶é—´**: ä¸åŒå¸‚åœºæœ‰ä¸åŒçš„äº¤æ˜“æ—¶é—´
3. **æœ€å°äº¤æ˜“å•ä½**: 
   - Aè‚¡: 100è‚¡èµ·ï¼Œ100è‚¡çš„æ•´æ•°å€
   - æ¸¯è‚¡: æ ¹æ®è‚¡ç¥¨ä¸åŒæœ‰ä¸åŒçš„ä¹°å–å•ä½
   - ç¾è‚¡: 1è‚¡èµ·
4. **è´¦æˆ·åŒ¹é…**: ç³»ç»Ÿä¼šè‡ªåŠ¨æ ¹æ®å¸‚åœºç±»å‹åŒ¹é…å¯¹åº”çš„è´¦æˆ·
5. **ä»·æ ¼ç²¾åº¦**: ä¸åŒå¸‚åœºå¯¹ä»·æ ¼ç²¾åº¦è¦æ±‚ä¸åŒ

## APIæ–‡æ¡£

è¯¦ç»†çš„APIæ¥å£æ–‡æ¡£è¯·å‚è€ƒ: [APIæ¥å£æ–‡æ¡£.md](./APIæ¥å£æ–‡æ¡£.md)

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•è·å–è´¦æˆ·IDï¼Ÿ

A: è¿è¡Œä»¥ä¸‹ä»£ç ï¼š

```python
import asyncio
from futu_client import FutuClient

async def main():
    client = FutuClient()
    accounts = await client.get_account_list()
    for acc in accounts:
        print(f"{acc['market_type']}: {acc['account_id']}")

asyncio.run(main())
```

### Q: ä¸‹å•å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. Cookieæ˜¯å¦æœ‰æ•ˆ
2. è´¦æˆ·IDæ˜¯å¦æ­£ç¡®
3. å¸‚åœºæ˜¯å¦å¼€ç›˜
4. ä½™é¢æ˜¯å¦è¶³å¤Ÿ
5. ä»·æ ¼å’Œæ•°é‡æ˜¯å¦ç¬¦åˆè¦æ±‚

### Q: å¦‚ä½•è·å–å®æ—¶ä»·æ ¼ï¼Ÿ

A: ä½¿ç”¨ `get_stock_quote` æ–¹æ³•è·å–æœ€æ–°è¡Œæƒ…æ•°æ®

### Q: æ”¯æŒå“ªäº›å¸‚åœºï¼Ÿ

A: ç›®å‰æ”¯æŒï¼š
- Aè‚¡ (CN)
- æ¸¯è‚¡ (HK)
- ç¾è‚¡ (US)

## æ›´å¤šç¤ºä¾‹

æŸ¥çœ‹é¡¹ç›®ä¸­çš„æµ‹è¯•æ–‡ä»¶ï¼š
- `test_place_order.py` - ä¸‹å•åŠŸèƒ½æµ‹è¯•
- `test_real_trade.py` - å®é™…äº¤æ˜“æµ‹è¯•
